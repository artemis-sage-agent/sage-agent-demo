<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.T.R.I.K.E. Fleet Analyzer — Fleet Intelligence for Star Atlas</title>
    <meta name="description" content="S.T.R.I.K.E. AI-powered faction analysis and ship optimization for Star Atlas: Golden Era. Real-time Galaxy API integration with verifiable recommendations.">
    
    <!-- Favicon -->
    <link rel="icon" href="../assets/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="../assets/favicon.svg" type="image/x-icon">

    <!-- Fonts: Satoshi (body) + General Sans (display) from Fontshare -->
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@300,400,500,700,900&f[]=general-sans@400,500,600,700&display=swap" rel="stylesheet">

    <style>
        /* ═══════════════════════════════════════════════════════
           Design System — Refined Luxury Minimal
           Matching index.html exactly
        ═══════════════════════════════════════════════════════ */

        :root {
            --bg:         #0c0c0c;
            --bg-raised:  #111111;
            --bg-subtle:  #161616;
            --border:     rgba(255, 255, 255, 0.06);
            --border-hover: rgba(255, 255, 255, 0.12);

            --text-primary:   #fafafa;
            --text-secondary: #a0a0a0;
            --text-tertiary:  #606060;

            --accent:     #00d4aa;
            --accent-dim: rgba(0, 212, 170, 0.12);

            --radius:     10px;
            --radius-lg:  16px;

            --font-body:    'Satoshi', -apple-system, system-ui, sans-serif;
            --font-display: 'General Sans', 'Satoshi', -apple-system, system-ui, sans-serif;
        }

        /* ── Reset ── */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.7;
            font-weight: 400;
            overflow-x: hidden;
        }

        a { color: inherit; text-decoration: none; }

        /* ── Tactical acronym styling ── */
        .tactical-acronym {
            letter-spacing: 0.15em;
            font-weight: 700;
        }
        img { max-width: 100%; display: block; }

        /* ── Selection ── */
        ::selection {
            background: var(--accent-dim);
            color: var(--accent);
        }

        /* ── Scroll-triggered fade-in ── */
        .reveal {
            opacity: 0;
            transform: translateY(24px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                        transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ═══════════════════════════════════════════════════════
           Navigation — Floating Pill (matching homepage)
        ═══════════════════════════════════════════════════════ */

        nav {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            padding: 0.8rem 1.6rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            background: rgba(12, 12, 12, 0.6);
            backdrop-filter: blur(24px) saturate(1.4);
            -webkit-backdrop-filter: blur(24px) saturate(1.4);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 100px;
            max-width: 900px;
            width: calc(100% - 2rem);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        nav.scrolled {
            background: rgba(12, 12, 12, 0.85);
            border-color: rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        .nav-logo {
            font-family: var(--font-display);
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .nav-logo .dot {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 8px var(--accent);
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1.8rem;
            list-style: none;
        }

        .nav-links a {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
            transition: color 0.3s;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--accent);
            transition: width 0.3s;
        }

        .nav-links a:hover { color: var(--text-primary); }
        .nav-links a:hover::after { width: 100%; }
        .nav-links a.active { color: var(--accent); }

        .nav-cta {
            font-size: 0.78rem !important;
            font-weight: 600 !important;
            color: var(--bg) !important;
            background: var(--text-primary);
            padding: 0.45rem 1.2rem;
            border-radius: 100px;
            transition: all 0.3s !important;
            white-space: nowrap;
        }

        .nav-cta::after { display: none !important; }

        .nav-cta:hover { opacity: 0.85; transform: translateY(-1px); box-shadow: 0 4px 16px rgba(255,255,255,0.15); }

        /* ═══════════════════════════════════════════════════════
           Container & Layout
        ═══════════════════════════════════════════════════════ */

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        main {
            min-height: 100vh;
            padding-top: 8rem;
            padding-bottom: 4rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-label {
            font-family: var(--font-display);
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-family: var(--font-display);
            font-size: clamp(1.8rem, 3.5vw, 2.6rem);
            font-weight: 600;
            line-height: 1.15;
            letter-spacing: -0.025em;
            margin-bottom: 1.2rem;
        }

        .section-desc {
            font-size: 1.05rem;
            color: var(--text-secondary);
            max-width: 520px;
            line-height: 1.75;
            margin: 0 auto;
        }

        /* ═══════════════════════════════════════════════════════
           Wallet Input Section
        ═══════════════════════════════════════════════════════ */

        .wallet-section {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            margin: 3rem 0;
            text-align: center;
        }

        .wallet-section:hover {
            border-color: var(--border-hover);
        }

        .wallet-title {
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .wallet-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .wallet-input-group {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .wallet-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 0.9rem;
            transition: all 0.25s ease;
            margin-bottom: 1rem;
        }

        .wallet-input::placeholder {
            color: var(--text-tertiary);
        }

        .wallet-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }

        .wallet-input.error {
            border-color: #ef4444;
        }

        .wallet-error {
            color: #ef4444;
            font-size: 0.8rem;
            text-align: left;
            margin-bottom: 1rem;
            display: none;
        }

        .wallet-error.visible {
            display: block;
        }

        .wallet-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .wallet-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            border: none;
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .wallet-btn-primary {
            background: var(--accent);
            color: var(--bg);
        }

        .wallet-btn-primary:hover {
            background: #00c499;
            transform: translateY(-1px);
        }

        .wallet-btn-primary:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
            transform: none;
        }

        .wallet-btn-secondary {
            background: var(--bg-subtle);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .wallet-btn-secondary:hover {
            background: var(--bg-raised);
            color: var(--text-primary);
            border-color: var(--border-hover);
        }

        .wallet-helper {
            margin-top: 1.5rem;
            font-size: 0.8rem;
            color: var(--text-tertiary);
            line-height: 1.6;
        }

        .wallet-connect-divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
            color: var(--text-tertiary);
            font-size: 0.75rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }
        .wallet-connect-divider::before,
        .wallet-connect-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .wallet-btn-connect {
            background: var(--accent);
            color: var(--bg);
            font-family: var(--font-display);
            font-weight: 600;
            letter-spacing: 0.02em;
            padding: 0.85rem 2rem;
            border: none;
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            transition: all 0.25s ease;
        }
        .wallet-btn-connect:hover {
            background: #00c499;
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(0, 212, 170, 0.15);
        }
        .wallet-btn-connect:disabled {
            background: var(--text-tertiary);
            color: var(--bg);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .wallet-btn-connect .wallet-icon {
            width: 18px;
            height: 18px;
        }
        .wallet-btn-connect.connected {
            background: transparent;
            color: var(--accent);
            border: 1px solid rgba(0, 212, 170, 0.3);
        }
        .wallet-btn-connect.connected:hover {
            border-color: rgba(0, 212, 170, 0.5);
            background: var(--accent-dim);
            box-shadow: none;
        }

        /* ═══════════════════════════════════════════════════════
           Fleet Breakdown & Ship Roster
        ═══════════════════════════════════════════════════════ */
        .fleet-breakdown {
            padding: 0 2.5rem 2rem;
        }
        .fleet-breakdown-title {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .fleet-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        .fleet-card:hover {
            border-color: var(--border-hover);
        }
        .fleet-card-header {
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .fleet-card-header:hover {
            background: rgba(255,255,255,0.02);
        }
        .fleet-card-name {
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        .fleet-card-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }
        .faction-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.03em;
        }
        .faction-mud { background: rgba(205,133,63,0.1); color: #b8956a; }
        .faction-oni { background: rgba(255,107,107,0.1); color: #d48a8a; }
        .faction-ustur { background: rgba(123,156,247,0.1); color: #8ea8d4; }
        .faction-unknown { background: rgba(255,255,255,0.04); color: var(--text-tertiary); }

        .fleet-card-ships {
            padding: 0 1rem 0.75rem;
            display: none;
        }
        .fleet-card-ships.expanded {
            display: block;
        }
        .fleet-ship-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.35rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 0.8rem;
        }
        .fleet-ship-row:last-child {
            border-bottom: none;
        }
        .fleet-ship-name {
            color: var(--text-secondary);
        }
        .fleet-ship-count {
            color: var(--accent);
            font-weight: 600;
            font-family: var(--font-display);
        }
        .fleet-card-toggle {
            transition: transform 0.2s;
            color: var(--text-tertiary);
        }
        .fleet-card-toggle.open {
            transform: rotate(180deg);
        }

        /* Per-fleet stats grid inside expanded card */
        .fleet-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
            margin: 0.75rem 0;
            padding: 0.75rem;
            background: rgba(0,0,0,0.3);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        .fleet-stat-mini {
            text-align: center;
        }
        .fleet-stat-mini-value {
            font-family: var(--font-display);
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--accent);
        }
        .fleet-stat-mini-label {
            font-family: var(--font-display);
            font-size: 0.6rem;
            color: var(--text-tertiary);
            letter-spacing: 0.04em;
            text-transform: uppercase;
            margin-top: 0.1rem;
        }
        .fleet-perf-rating {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-family: var(--font-display);
            font-weight: 600;
            letter-spacing: 0.03em;
            margin-top: 0.5rem;
        }
        .fleet-rec {
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--accent-dim);
            border-radius: var(--radius);
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .fleet-rec strong { color: var(--accent); }

        /* Target Objective Selector */
        .objective-selector {
            padding: 0 2.5rem 1.5rem;
        }
        .objective-selector-title {
            font-family: var(--font-display);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        .objective-pills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .objective-pill {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--bg-raised);
            color: var(--text-secondary);
            font-family: var(--font-display);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .objective-pill:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }
        .objective-pill.active {
            border-color: var(--accent);
            background: var(--accent-dim);
            color: var(--accent);
        }

        .ship-roster {
            padding: 0 2.5rem 2rem;
        }
        .ship-roster-title {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ship-roster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 0.75rem;
        }
        .ship-roster-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem 1rem;
            transition: border-color 0.2s;
        }
        .ship-roster-card:hover {
            border-color: var(--accent);
        }
        .ship-roster-name {
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .ship-roster-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ship-roster-qty {
            color: var(--accent);
            font-weight: 700;
            font-family: var(--font-display);
        }
        .ship-roster-class {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ═══════════════════════════════════════════════════════
           Your Fleet Section
        ═══════════════════════════════════════════════════════ */

        .your-fleet-section {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin: 2rem 0;
            overflow: hidden;
            display: none;
        }

        .your-fleet-section.visible {
            display: block;
        }

        .your-fleet-section:hover {
            border-color: var(--border-hover);
        }

        .fleet-header {
            background: linear-gradient(135deg, var(--accent-dim), var(--bg-subtle));
            padding: 2rem 2.5rem;
            border-bottom: 1px solid var(--border);
        }

        .fleet-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .fleet-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .fleet-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            padding: 2rem 2.5rem;
        }

        .fleet-stat {
            text-align: center;
        }

        .fleet-stat-value {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.25rem;
        }

        .fleet-stat-label {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            letter-spacing: 0.02em;
        }

        /* ═══════════════════════════════════════════════════════
           Fleet Composition Score
        ═══════════════════════════════════════════════════════ */

        .composition-score {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), var(--bg-subtle));
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
        }

        .score-title {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: #f59e0b;
            margin-bottom: 0.5rem;
        }

        .score-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 700;
            color: #f59e0b;
            margin-bottom: 0.5rem;
        }

        .score-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ═══════════════════════════════════════════════════════
           Personalized Recommendations
        ═══════════════════════════════════════════════════════ */

        .personalized-recommendations {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin: 2rem 0;
            overflow: hidden;
            display: none;
        }

        .personalized-recommendations.visible {
            display: block;
        }

        .personalized-recommendations:hover {
            border-color: var(--border-hover);
        }

        .personal-rec-header {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), var(--bg-subtle));
            padding: 2rem 2.5rem;
            border-bottom: 1px solid var(--border);
        }

        .personal-rec-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #3b82f6;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .personal-rec-content {
            padding: 2rem 2.5rem;
        }

        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .rec-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            border-left: 3px solid #3b82f6;
        }

        .rec-card-title {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rec-card-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .earnings-estimate {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), var(--bg-subtle));
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            text-align: center;
        }

        .earnings-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .earnings-value {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            color: #f59e0b;
            margin-bottom: 0.25rem;
        }

        .earnings-period {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        /* ═══════════════════════════════════════════════════════
           No Fleet State
        ═══════════════════════════════════════════════════════ */

        .no-fleet-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
            display: none;
        }

        .no-fleet-state.visible {
            display: block;
        }

        .no-fleet-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .no-fleet-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .no-fleet-desc {
            font-size: 0.9rem;
            line-height: 1.6;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ═══════════════════════════════════════════════════════
           Faction Selector — Elegant Pills
        ═══════════════════════════════════════════════════════ */

        .faction-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 3rem 0;
            flex-wrap: wrap;
        }

        .faction-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            color: var(--text-secondary);
        }

        .faction-pill:hover {
            border-color: var(--border-hover);
            background: var(--bg-subtle);
            transform: translateY(-2px);
        }

        .faction-pill.active {
            background: var(--accent-dim);
            border-color: rgba(0, 212, 170, 0.3);
            color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.15);
        }

        .faction-icon {
            font-size: 1.2rem;
        }

        .faction-name {
            font-weight: 600;
        }

        .faction-subtitle {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-left: 0.5rem;
        }

        /* ═══════════════════════════════════════════════════════
           Analysis Cards & Results
        ═══════════════════════════════════════════════════════ */

        .analysis-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin: 2rem 0;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }

        .analysis-card:hover {
            border-color: var(--border-hover);
        }

        .card-header {
            padding: 2rem 2.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg-subtle);
        }

        .card-title {
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .card-content {
            padding: 2.5rem;
        }

        /* ═══════════════════════════════════════════════════════
           Loading State
        ═══════════════════════════════════════════════════════ */

        .loading-state {
            display: none;
            text-align: center;
            padding: 4rem 2rem;
        }

        .loading-state.visible {
            display: block;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* ═══════════════════════════════════════════════════════
           Results Grid
        ═══════════════════════════════════════════════════════ */

        .results-container {
            display: none;
        }

        .results-container.visible {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            transition: background 0.25s ease;
        }

        .stat-card:hover {
            background: var(--bg-subtle);
        }

        .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            letter-spacing: 0.02em;
        }

        /* ═══════════════════════════════════════════════════════
           Info Cards
        ═══════════════════════════════════════════════════════ */

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .info-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        .info-card h4 {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-list {
            list-style: none;
        }

        .info-list li {
            padding: 0.4rem 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        /* ═══════════════════════════════════════════════════════
           Ships Grid
        ═══════════════════════════════════════════════════════ */

        .ships-section {
            margin-top: 3rem;
        }

        .ships-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .ship-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.2rem;
            transition: all 0.25s ease;
        }

        .ship-card:hover {
            background: var(--bg-subtle);
            border-color: var(--border-hover);
        }

        .ship-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .ship-rarity {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .ship-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .ship-info {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-bottom: 0.5rem;
        }

        .ship-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .ship-stat {
            display: flex;
            justify-content: space-between;
        }

        .ship-tags {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .ship-tag {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            background: var(--bg-subtle);
            border-radius: 4px;
            color: var(--text-secondary);
        }

        /* ═══════════════════════════════════════════════════════
           Recommendations
        ═══════════════════════════════════════════════════════ */

        .recommendations-section {
            margin-top: 3rem;
        }

        .recommendation-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 3px solid var(--accent);
        }

        .recommendation-card:last-child {
            margin-bottom: 0;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .rec-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .rec-priority {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 100px;
            background: var(--accent-dim);
            color: var(--accent);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .rec-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* ═══════════════════════════════════════════════════════
           Footer
        ═══════════════════════════════════════════════════════ */

        footer {
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            padding: 4rem 2rem 3rem;
            margin-top: 6rem;
            background: var(--bg-subtle);
        }

        .footer-inner {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 4rem;
            align-items: start;
        }

        .footer-logo {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .footer-desc {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            margin: 0;
        }

        .footer-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 3rem;
        }

        .footer-section h4 {
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            letter-spacing: 0.02em;
        }

        .footer-section ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .footer-section li {
            margin-bottom: 0.6rem;
        }

        .footer-section a {
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: color 0.25s ease;
            letter-spacing: 0.01em;
        }

        .footer-section a:hover {
            color: var(--accent);
        }

        .footer-section a[target="_blank"]::after {
            content: '↗';
            margin-left: 0.4rem;
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .footer-bottom {
            max-width: 1100px;
            margin: 3rem auto 0;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.78rem;
            color: var(--text-tertiary);
        }

        /* ═══════════════════════════════════════════════════════
           SAGE Fleet Optimizer Styling
        ═══════════════════════════════════════════════════════ */

        .optimizer-section {
            margin-top: 6rem;
            padding: 0;
        }

        .optimizer-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .optimizer-tab {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .optimizer-tab:hover {
            background: var(--bg-raised);
            color: var(--text-primary);
            border-color: var(--border-hover);
        }

        .optimizer-tab.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .optimizer-content {
            display: none;
        }

        .optimizer-content.active {
            display: block;
        }

        .optimizer-card {
            background: var(--bg-raised);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            margin-bottom: 2rem;
        }

        .optimizer-card:hover {
            border-color: var(--border-hover);
        }

        .optimizer-card h3 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .optimizer-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .fleet-points-summary {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .points-display {
            margin-bottom: 0.5rem;
        }

        .points-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-right: 0.5rem;
        }

        .points-label {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .fleets-needed {
            color: var(--text-tertiary);
            font-size: 0.9rem;
        }

        .optimizer-form-group {
            margin-bottom: 1.5rem;
        }

        .optimizer-form-group label {
            display: block;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .optimizer-form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 0.9rem;
            transition: all 0.25s ease;
        }

        .optimizer-form-control::placeholder {
            color: var(--text-tertiary);
        }

        .optimizer-form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }

        .optimizer-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .ship-inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .ship-inventory-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
        }

        .ship-inventory-card:hover {
            border-color: var(--border-hover);
            background: var(--bg-raised);
        }

        .ship-inventory-card.selected {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .ship-inventory-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .ship-inventory-class {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .ship-inventory-points {
            color: var(--accent);
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .ship-inventory-stats {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            line-height: 1.4;
        }

        .ship-inventory-quantity {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent);
            color: var(--bg);
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .objective-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .objective-option {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.25s ease;
            text-align: center;
        }

        .objective-option:hover {
            border-color: var(--border-hover);
            background: var(--bg-raised);
        }

        .objective-option.selected {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .objective-option h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .objective-option p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.4;
            margin: 0;
        }

        .optimizer-btn {
            padding: 0.875rem 2rem;
            border-radius: var(--radius);
            border: none;
            font-family: var(--font-display);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .optimizer-btn-primary {
            background: var(--accent);
            color: var(--bg);
        }

        .optimizer-btn-primary:hover {
            background: #00c499;
            transform: translateY(-1px);
        }

        .optimizer-results {
            margin-top: 2rem;
        }

        .optimizer-results h3 {
            font-family: var(--font-display);
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .optimizer-info-box {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: var(--accent);
            font-size: 0.9rem;
        }

        .optimizer-error-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: #ef4444;
            font-size: 0.9rem;
        }

        .optimizer-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-subtle);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .optimizer-table th,
        .optimizer-table td {
            padding: 0.875rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .optimizer-table th {
            background: var(--bg-raised);
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .optimizer-table td {
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        .optimizer-table tbody tr:hover {
            background: var(--bg-raised);
        }

        .fleet-composition {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .fleet-composition-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .fleet-composition-ships {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .fleet-composition-stats {
            color: var(--text-tertiary);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        /* ═══════════════════════════════════════════════════════
           Responsive
        ═══════════════════════════════════════════════════════ */

        @media (max-width: 768px) {
            nav { top: 8px; padding: 0.65rem 1.2rem; border-radius: 16px; }
            .nav-links { display: none; }

            main { padding-top: 6rem; }
            .container { padding: 0 1.5rem; }

            .wallet-section { padding: 2rem 1.5rem; }
            .wallet-buttons { flex-direction: column; align-items: center; }
            .wallet-btn { width: 100%; max-width: 250px; justify-content: center; }

            .faction-selector {
                flex-direction: column;
                align-items: center;
                gap: 0.75rem;
            }

            .faction-pill {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }

            .stats-grid, .fleet-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-grid, .rec-grid {
                grid-template-columns: 1fr;
            }

            .ships-grid {
                grid-template-columns: 1fr;
            }

            footer {
                padding: 3rem 1.5rem 2rem;
                margin-top: 4rem;
            }
            
            .footer-inner {
                grid-template-columns: 1fr;
                gap: 2.5rem;
                text-align: center;
            }
            
            .footer-nav {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }

            .footer-bottom {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .footer-nav {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }

        /* ── Grain overlay — very subtle texture ── */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.015;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 128px 128px;
        }
    </style>
</head>
<body>

    <!-- ════════════════════════════════════════════════════
         Navigation — Matching index.html exactly
    ════════════════════════════════════════════════════ -->
    <nav>
        <a href="../index.html" class="nav-logo">
            <span class="dot"></span>
            <span class="tactical-acronym">S.T.R.I.K.E.</span>
        </a>
        <ul class="nav-links">
            <li><a href="../index.html#features">Features</a></li>
            <li><a href="../index.html#how-it-works">How It Works</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="analyzer.html" class="active">Analyzer</a></li>
            <li><a href="../docs/manifesto.html">Manifesto</a></li>
            <li><a href="../docs/roadmap.html">Roadmap</a></li>
            <li><a href="https://github.com/artemis-sage-agent/sage-agent-demo" target="_blank" rel="noopener">GitHub</a></li>
            <li><a href="dashboard.html" class="nav-cta">Launch App</a></li>
        </ul>
    </nav>

    <!-- ════════════════════════════════════════════════════
         Main Content
    ════════════════════════════════════════════════════ -->
    <main>
        <div class="container">
            <div class="section-header reveal">
                <p class="section-label">Fleet Intelligence</p>
                <h1 class="section-title"><span class="tactical-acronym">S.T.R.I.K.E.</span> Fleet Analyzer</h1>
                <p class="section-desc">
                    Deep faction analysis powered by real Star Atlas ship data. 
                    Connect your wallet for personalized fleet recommendations, or explore faction strategies with actual SAGE mechanics.
                </p>
            </div>

            <!-- ════════════════════════════════════════════════════
                 Wallet Input Section
            ════════════════════════════════════════════════════ -->
            <div class="wallet-section reveal">
                <h2 class="wallet-title">Connect Your Fleet</h2>
                <p class="wallet-subtitle">Enter your wallet address or SAGE player profile for personalized fleet recommendations</p>
                
                <div class="wallet-input-group">
                    <!-- Wallet Connect Button -->
                    <div class="wallet-buttons" style="margin-bottom:0">
                        <button class="wallet-btn wallet-btn-connect" id="walletConnectBtn" onclick="connectWallet()">
                            <svg class="wallet-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="6" width="20" height="14" rx="2"/>
                                <path d="M2 10h20"/>
                                <circle cx="17" cy="15" r="1.5" fill="currentColor"/>
                            </svg>
                            <span id="walletConnectLabel">Connect Wallet</span>
                        </button>
                    </div>

                    <div class="wallet-connect-divider">or enter address manually</div>

                    <input 
                        type="text" 
                        class="wallet-input" 
                        id="walletInput" 
                        placeholder="Enter wallet address or SAGE profile..."
                        autocomplete="off"
                        spellcheck="false"
                    >
                    <div class="wallet-error" id="walletError"></div>
                    
                    <div class="wallet-buttons">
                        <button class="wallet-btn wallet-btn-primary" id="analyzeFleetBtn" onclick="analyzeWallet()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            Analyze Fleet
                        </button>
                        
                        <button class="wallet-btn wallet-btn-secondary" onclick="tryDemo()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13,2 3,14 12,22 22,10"/>
                            </svg>
                            Try Demo
                        </button>
                        
                        <button class="wallet-btn wallet-btn-secondary" onclick="tryDemoWallet()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22,2 15,22 11,13 2,9"/>
                            </svg>
                            Try Demo Wallet
                        </button>
                    </div>
                    
                    <p class="wallet-helper">
                        🔒 Read-only access — we never request transaction signing.
                        Your wallet connection is used solely to read your public address.
                    </p>
                </div>
            </div>

            <!-- ════════════════════════════════════════════════════
                 Your Fleet Section
            ════════════════════════════════════════════════════ -->
            <div class="your-fleet-section" id="yourFleetSection">
                <div class="fleet-header">
                    <h3 class="fleet-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 7l5 5-5 5"/>
                            <path d="M6 12h12"/>
                        </svg>
                        Your Fleet
                    </h3>
                    <p class="fleet-subtitle" id="fleetWalletAddress"></p>
                </div>
                
                <!-- Fleet Breakdown — FIRST block (populated when SAGE data available) -->
                <div class="fleet-breakdown" id="fleetBreakdown" style="display:none;">
                    <!-- Will be populated by JavaScript -->
                </div>

                <div class="fleet-stats" id="fleetStats">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div class="composition-score" id="compositionScore">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Target Objective Selector -->
                <div class="objective-selector" id="objectiveSelector" style="display:none;">
                    <div class="objective-selector-title">Target Objective</div>
                    <div class="objective-pills">
                        <div class="objective-pill active" data-objective="balanced" onclick="selectObjective('balanced')">⚖️ Balanced</div>
                        <div class="objective-pill" data-objective="mining" onclick="selectObjective('mining')">⛏️ Mining</div>
                        <div class="objective-pill" data-objective="scanning" onclick="selectObjective('scanning')">📡 Scanning</div>
                        <div class="objective-pill" data-objective="crafting" onclick="selectObjective('crafting')">🏗️ Crafting</div>
                    </div>
                </div>

                <!-- Complete Ship Roster -->
                <div class="ship-roster" id="shipRoster" style="display:none;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- ════════════════════════════════════════════════════
                 Personalized Recommendations
            ════════════════════════════════════════════════════ -->
            <div class="personalized-recommendations" id="personalizedRecommendations">
                <div class="personal-rec-header">
                    <h3 class="personal-rec-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22,2 15,22 11,13 2,9"/>
                        </svg>
                        Personalized Recommendations
                    </h3>
                    <p class="fleet-subtitle">AI-powered insights based on your actual fleet composition with real SAGE mechanics</p>
                </div>
                
                <div class="personal-rec-content" id="personalRecContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- ════════════════════════════════════════════════════
                 No Fleet Found State
            ════════════════════════════════════════════════════ -->
            <div class="no-fleet-state" id="noFleetState">
                <div class="no-fleet-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                </div>
                <h3 class="no-fleet-title">No Star Atlas Fleet Found</h3>
                <p class="no-fleet-desc">
                    No Star Atlas assets found for this wallet. Try a different address or explore faction strategies below.
                    Make sure you own Star Atlas NFTs (ships) for analysis.
                </p>
            </div>

            <!-- Faction Selector -->
            <div class="faction-selector reveal">
                <div class="faction-pill active" data-faction="mud" onclick="selectFaction('mud')">
                    <div class="faction-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 7V4a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v3"/>
                            <path d="M16 21V8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v13"/>
                            <path d="M6 11h8"/>
                            <path d="M6 15h8"/>
                        </svg>
                    </div>
                    <div>
                        <div class="faction-name">MUD</div>
                        <div class="faction-subtitle">Industrial Might</div>
                    </div>
                </div>
                
                <div class="faction-pill" data-faction="oni" onclick="selectFaction('oni')">
                    <div class="faction-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                    <div>
                        <div class="faction-name">ONI</div>
                        <div class="faction-subtitle">Technological Edge</div>
                    </div>
                </div>
                
                <div class="faction-pill" data-faction="ustur" onclick="selectFaction('ustur')">
                    <div class="faction-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="4" width="6" height="6"/>
                            <rect x="14" y="4" width="6" height="6"/>
                            <rect x="4" y="14" width="6" height="6"/>
                            <rect x="14" y="14" width="6" height="6"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                        </svg>
                    </div>
                    <div>
                        <div class="faction-name">USTUR</div>
                        <div class="faction-subtitle">Automation Elite</div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <p class="loading-text">Calculating with real ship stats...</p>
            </div>

            <!-- Results Container -->
            <div class="results-container" id="resultsContainer">
                <!-- Analysis Card -->
                <div class="analysis-card reveal">
                    <div class="card-header">
                        <h2 class="card-title" id="factionTitle">MUD — Manus Ultimus Dei</h2>
                        <p class="card-subtitle" id="factionDescription">The industrial powerhouse of Star Atlas, dominating manufacturing and resource extraction across the galaxy.</p>
                    </div>
                    
                    <div class="card-content">
                        <!-- Stats Grid -->
                        <div class="stats-grid" id="statsGrid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M13 7l5 5-5 5M6 12h12"/>
                                    </svg>
                                </div>
                                <div class="stat-value" id="shipCount">0</div>
                                <div class="stat-label">Available Ships</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="22" y1="2" x2="11" y2="13"/>
                                    </svg>
                                </div>
                                <div class="stat-value" id="avgMiningRate">0</div>
                                <div class="stat-label">Avg Mining Rate</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="9" y1="9" x2="15" y2="15"/>
                                        <line x1="15" y1="9" x2="9" y2="15"/>
                                    </svg>
                                </div>
                                <div class="stat-value" id="avgCargo">0</div>
                                <div class="stat-label">Avg Cargo</div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M13 7l5 5-5 5"/>
                                        <path d="M6 12h12"/>
                                    </svg>
                                </div>
                                <div class="stat-value" id="avgWarpSpeed">0</div>
                                <div class="stat-label">Avg Warp Speed</div>
                            </div>
                        </div>

                        <!-- Info Grid -->
                        <div class="info-grid">
                            <div class="info-card">
                                <h4>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <circle cx="12" cy="12" r="6"/>
                                        <circle cx="12" cy="12" r="2"/>
                                    </svg>
                                    Top Mining Ships
                                </h4>
                                <ul class="info-list" id="topMiners">
                                    <!-- Will be populated by JS -->
                                </ul>
                            </div>
                            
                            <div class="info-card">
                                <h4>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="m12 1 3 3v6a6 6 0 1 1-12 0V4l3-3z"/>
                                        <path d="M12 8v13"/>
                                    </svg>
                                    Best Cargo Ships
                                </h4>
                                <ul class="info-list" id="topCargo">
                                    <!-- Will be populated by JS -->
                                </ul>
                            </div>
                            
                            <div class="info-card">
                                <h4>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <circle cx="12" cy="12" r="6"/>
                                        <circle cx="12" cy="12" r="2"/>
                                        <path d="m8 3 4 8 5-3"/>
                                    </svg>
                                </h4>
                                <ul class="info-list" id="optimalSectors">
                                    <!-- Will be populated by JS -->
                                </ul>
                            </div>
                            
                            <div class="info-card">
                                <h4>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="22" y1="2" x2="11" y2="13"/>
                                        <polygon points="22,2 15,22 11,13 2,9"/>
                                    </svg>
                                    Strategic Focus
                                </h4>
                                <ul class="info-list" id="strategicFocus">
                                    <!-- Will be populated by JS -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ships Section -->
                <div class="ships-section reveal">
                    <div class="analysis-card">
                        <div class="card-header">
                            <h3 class="card-title">Fleet Composition — Real Ship Stats</h3>
                            <p class="card-subtitle">Ships with actual SAGE statistics from the game's data files</p>
                        </div>
                        
                        <div class="card-content">
                            <div class="ships-grid" id="shipsGrid">
                                <!-- Will be populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="recommendations-section reveal">
                    <div class="analysis-card">
                        <div class="card-header">
                            <h3 class="card-title">Strategic Recommendations</h3>
                            <p class="card-subtitle">AI-powered optimization suggestions based on real ship capabilities</p>
                        </div>
                        
                        <div class="card-content" id="recommendationsContainer">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ════════════════════════════════════════════════════
                 SAGE Fleet Optimizer Section
            ════════════════════════════════════════════════════ -->
            <div class="optimizer-section reveal">
                <div class="section-header">
                    <p class="section-label">Fleet Optimization</p>
                    <h2 class="section-title">SAGE Fleet Optimizer</h2>
                    <p class="section-desc">
                        Advanced fleet composition, LP efficiency analysis, and market arbitrage calculations using real SAGE game data.
                    </p>
                </div>

                <!-- Optimizer Tabs -->
                <div class="optimizer-tabs">
                    <button class="optimizer-tab active" data-tab="fleet" onclick="showOptimizerTab('fleet')">Fleet Builder</button>
                    <button class="optimizer-tab" data-tab="lp" onclick="showOptimizerTab('lp')">LP Efficiency</button>
                    <button class="optimizer-tab" data-tab="arbitrage" onclick="showOptimizerTab('arbitrage')">Market Arbitrage</button>
                </div>

                <!-- Fleet Builder Tab -->
                <div id="optimizer-fleet" class="optimizer-content active">
                    <div class="optimizer-card">
                        <h3>Ship Inventory</h3>
                        <p class="optimizer-desc">Select ships from your inventory. Click to add, click again to increase quantity. Fleet point cap: 145 per fleet.</p>
                        
                        <div class="fleet-points-summary">
                            <div class="points-display">
                                <span class="points-value" id="totalFleetPoints">0</span>
                                <span class="points-label">/ 145 Points</span>
                            </div>
                            <div class="fleets-needed">
                                Fleets Needed: <span id="fleetsNeeded">0</span>
                            </div>
                        </div>

                        <div class="optimizer-form-group">
                            <label>Filter by Class:</label>
                            <select class="optimizer-form-control" id="shipClassFilter" onchange="filterShipsByClass()">
                                <option value="">All Classes</option>
                                <option value="1">Class 1 (1 point)</option>
                                <option value="2">Class 2 (4 points)</option>
                                <option value="3">Class 3 (9 points)</option>
                                <option value="4">Class 4 (16 points)</option>
                                <option value="5">Class 5 (25 points)</option>
                                <option value="6">Class 6 (36 points)</option>
                                <option value="7">Class 7 (49 points)</option>
                                <option value="9">Class 9 (81 points)</option>
                            </select>
                        </div>

                        <div class="ship-inventory-grid" id="shipInventoryGrid">
                            <!-- Ships will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="optimizer-card">
                        <h3>Fleet Objective</h3>
                        <p class="optimizer-desc">Select your primary fleet objective to optimize ship composition.</p>
                        
                        <div class="objective-selector" id="objectiveSelector">
                            <div class="objective-option selected" data-objective="mining" onclick="selectFleetObjective('mining')">
                                <h4>Mining</h4>
                                <p>Optimize for mining rate and cargo capacity</p>
                            </div>
                            <div class="objective-option" data-objective="scanning" onclick="selectFleetObjective('scanning')">
                                <h4>Scanning</h4>
                                <p>Maximize SDU production and survey efficiency</p>
                            </div>
                            <div class="objective-option" data-objective="freighting" onclick="selectFleetObjective('freighting')">
                                <h4>Freighting</h4>
                                <p>Optimize cargo capacity and fuel efficiency</p>
                            </div>
                            <div class="objective-option" data-objective="crafting" onclick="selectFleetObjective('crafting')">
                                <h4>Crafting</h4>
                                <p>Maximize crew and cargo for production chains</p>
                            </div>
                            <div class="objective-option" data-objective="profit" onclick="selectFleetObjective('profit')">
                                <h4>Profit Max</h4>
                                <p>Balance efficiency across all activities</p>
                            </div>
                        </div>

                        <button class="optimizer-btn optimizer-btn-primary" onclick="optimizeFleetComposition()">Optimize Fleet Composition</button>
                        
                        <div class="optimizer-results" id="fleetOptimizerResults" style="display: none;">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- LP Efficiency Tab -->
                <div id="optimizer-lp" class="optimizer-content">
                    <div class="optimizer-card">
                        <h3>LP Efficiency Calculator</h3>
                        <p class="optimizer-desc">Calculate net LP per hour and LP per ATLAS for all craftable items, including supply chain complexity and compounding fees.</p>

                        <div class="optimizer-form-grid">
                            <div class="optimizer-form-group">
                                <label>Available Crew:</label>
                                <input type="number" class="optimizer-form-control" id="lpAvailableCrew" value="100" min="1">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Mining Travel Time (h):</label>
                                <input type="number" class="optimizer-form-control" id="lpMiningTravel" value="2" min="0" step="0.1">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Starbase Travel Time (h):</label>
                                <input type="number" class="optimizer-form-control" id="lpStarbaseTravel" value="1" min="0" step="0.1">
                            </div>
                            <div class="optimizer-form-group">
                                <label>ATLAS Price (USD):</label>
                                <input type="number" class="optimizer-form-control" id="lpAtlasPrice" value="0.003" min="0" step="0.0001">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Price Multiplier:</label>
                                <input type="number" class="optimizer-form-control" id="lpPriceMultiplier" value="1.2" min="0.1" step="0.1">
                            </div>
                        </div>

                        <button class="optimizer-btn optimizer-btn-primary" onclick="calculateLPEfficiency()">Calculate LP Efficiency</button>
                        
                        <div class="optimizer-results" id="lpResults" style="display: none;">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Market Arbitrage Tab -->
                <div id="optimizer-arbitrage" class="optimizer-content">
                    <div class="optimizer-card">
                        <h3>Market Arbitrage Calculator</h3>
                        <p class="optimizer-desc">Calculate profit potential for trading runs between different locations using your fleet composition.</p>

                        <div class="optimizer-form-grid">
                            <div class="optimizer-form-group">
                                <label>Resource:</label>
                                <select class="optimizer-form-control" id="arbitrageResource" onchange="updateArbitragePriceSuggestions()">
                                    <option value="">Select Resource</option>
                                </select>
                            </div>
                            <div class="optimizer-form-group">
                                <label>Trade Ship:</label>
                                <select class="optimizer-form-control" id="arbitrageTradeShip">
                                    <option value="">Select Ship</option>
                                </select>
                            </div>
                            <div class="optimizer-form-group">
                                <label>Buy Price (ATLAS):</label>
                                <input type="number" class="optimizer-form-control" id="arbitrageBuyPrice" step="0.000001">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Sell Price (ATLAS):</label>
                                <input type="number" class="optimizer-form-control" id="arbitrageSellPrice" step="0.000001">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Distance (sectors):</label>
                                <input type="number" class="optimizer-form-control" id="arbitrageDistance" value="5" min="1">
                            </div>
                            <div class="optimizer-form-group">
                                <label>Number of Trips:</label>
                                <input type="number" class="optimizer-form-control" id="arbitrageTrips" value="10" min="1">
                            </div>
                        </div>

                        <button class="optimizer-btn optimizer-btn-primary" onclick="calculateArbitrageProfit()">Calculate Profit</button>
                        
                        <div class="optimizer-results" id="arbitrageResults" style="display: none;">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // ═══════════════════════════════════════════════════════
        // Real SAGE Ship Stats Data (from CSV)
        // ═══════════════════════════════════════════════════════
        const SAGE_SHIP_STATS = [
            { symbol: "PULSE", shipName: "Busan Pulse", manufacturer: "Busan", spec: "Racer", class: "1", cargoCapacity: 249, fuelCapacity: 450, ammoCapacity: 104, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.013, miningRate: 0.262, subwarpSpeed: 0.0086, warpSpeed: 0.1, maxWarpDistance: 1.8, warpCoolDown: 60, warpFuelConsumptionRate: 19.5, subwarpFuelConsumptionRate: 5.35, planetExitFuelAmount: 5, scanCoolDown: 678, sduPerScan: 7, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 51 },
            { symbol: "FBLAIR", shipName: "Fimbul Airbike", manufacturer: "Fimbul", spec: "Racer", class: "1", cargoCapacity: 249, fuelCapacity: 450, ammoCapacity: 104, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.013, miningRate: 0.262, subwarpSpeed: 0.0084, warpSpeed: 0.1, maxWarpDistance: 1.75, warpCoolDown: 60, warpFuelConsumptionRate: 18.76, subwarpFuelConsumptionRate: 5.15, planetExitFuelAmount: 5, scanCoolDown: 786, sduPerScan: 6, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 51 },
            { symbol: "FBLEUN", shipName: "Fimbul ECOS Unibomba", manufacturer: "Fimbul ECOS", spec: "Bomber", class: "1", cargoCapacity: 274, fuelCapacity: 267, ammoCapacity: 336, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.016, miningRate: 0.325, subwarpSpeed: 0.0052, warpSpeed: 0.1, maxWarpDistance: 1.9, warpCoolDown: 60, warpFuelConsumptionRate: 15.48, subwarpFuelConsumptionRate: 4.25, planetExitFuelAmount: 4, scanCoolDown: 600, sduPerScan: 7, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 72 },
            { symbol: "OGKARU", shipName: "Ogrika Ruch", manufacturer: "Ogrika", spec: "Racer", class: "1", cargoCapacity: 249, fuelCapacity: 450, ammoCapacity: 104, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.013, miningRate: 0.262, subwarpSpeed: 0.0076, warpSpeed: 0.1, maxWarpDistance: 1.6, warpCoolDown: 60, warpFuelConsumptionRate: 17.82, subwarpFuelConsumptionRate: 4.9, planetExitFuelAmount: 5, scanCoolDown: 786, sduPerScan: 6, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 51 },
            { symbol: "OPALJ", shipName: "Opal Jet", manufacturer: "Opal", spec: "Racer", class: "1", cargoCapacity: 249, fuelCapacity: 450, ammoCapacity: 104, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.013, miningRate: 0.262, subwarpSpeed: 0.0081, warpSpeed: 0.1, maxWarpDistance: 1.95, warpCoolDown: 60, warpFuelConsumptionRate: 18.05, subwarpFuelConsumptionRate: 4.96, planetExitFuelAmount: 5, scanCoolDown: 786, sduPerScan: 6, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 51 },
            { symbol: "PX4", shipName: "Pearce X4", manufacturer: "Pearce", spec: "Fighter", class: "1", cargoCapacity: 389, fuelCapacity: 267, ammoCapacity: 228, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.016, miningRate: 0.320, subwarpSpeed: 0.0070, warpSpeed: 0.1, maxWarpDistance: 2, warpCoolDown: 60, warpFuelConsumptionRate: 15.48, subwarpFuelConsumptionRate: 4.25, planetExitFuelAmount: 4, scanCoolDown: 720, sduPerScan: 6, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 72 },
            { symbol: "VZUSSO", shipName: "VZUS solos", manufacturer: "VZUS", spec: "Racer", class: "1", cargoCapacity: 249, fuelCapacity: 450, ammoCapacity: 104, foodConsumptionRate: 0.014, ammoConsumptionRate: 0.013, miningRate: 0.262, subwarpSpeed: 0.0076, warpSpeed: 0.1, maxWarpDistance: 1.8, warpCoolDown: 60, warpFuelConsumptionRate: 18.29, subwarpFuelConsumptionRate: 5.02, planetExitFuelAmount: 5, scanCoolDown: 744, sduPerScan: 6, scanCost: 22, requiredCrew: 1, passengerCapacity: 0, respawnTime: 51 },
            { symbol: "CALMAX", shipName: "Calico Maxhog", manufacturer: "Calico", spec: "Transport", class: "2", cargoCapacity: 2205, fuelCapacity: 1150, ammoCapacity: 288, foodConsumptionRate: 0.067, ammoConsumptionRate: 0.037, miningRate: 0.743, subwarpSpeed: 0.0067, warpSpeed: 0.1, maxWarpDistance: 4.2, warpCoolDown: 120, warpFuelConsumptionRate: 36.97, subwarpFuelConsumptionRate: 10.16, planetExitFuelAmount: 10, scanCoolDown: 696, sduPerScan: 19, scanCost: 51, requiredCrew: 1, passengerCapacity: 1, respawnTime: 89 },
            { symbol: "CALSCD", shipName: "Calico Scud", manufacturer: "Calico", spec: "Racer", class: "2", cargoCapacity: 863, fuelCapacity: 1797, ammoCapacity: 359, foodConsumptionRate: 0.032, ammoConsumptionRate: 0.040, miningRate: 0.810, subwarpSpeed: 0.0078, warpSpeed: 0.1, maxWarpDistance: 3.4, warpCoolDown: 120, warpFuelConsumptionRate: 54.37, subwarpFuelConsumptionRate: 14.94, planetExitFuelAmount: 15, scanCoolDown: 744, sduPerScan: 19, scanCost: 51, requiredCrew: 1, passengerCapacity: 0, respawnTime: 69 },
            { symbol: "FBLLOW", shipName: "Fimbul Lowbie", manufacturer: "Fimbul", spec: "Transport", class: "2", cargoCapacity: 1965, fuelCapacity: 1390, ammoCapacity: 288, foodConsumptionRate: 0.067, ammoConsumptionRate: 0.037, miningRate: 0.743, subwarpSpeed: 0.0061, warpSpeed: 0.1, maxWarpDistance: 4.1, warpCoolDown: 120, warpFuelConsumptionRate: 40.6, subwarpFuelConsumptionRate: 11.15, planetExitFuelAmount: 11, scanCoolDown: 756, sduPerScan: 18, scanCost: 51, requiredCrew: 1, passengerCapacity: 1, respawnTime: 89 },
            { symbol: "OGKANR", shipName: "Ogrika Niruch", manufacturer: "Ogrika", spec: "Transport", class: "2", cargoCapacity: 1965, fuelCapacity: 1390, ammoCapacity: 288, foodConsumptionRate: 0.067, ammoConsumptionRate: 0.037, miningRate: 0.743, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 4, warpCoolDown: 120, warpFuelConsumptionRate: 37.7, subwarpFuelConsumptionRate: 10.36, planetExitFuelAmount: 10, scanCoolDown: 732, sduPerScan: 18, scanCost: 51, requiredCrew: 1, passengerCapacity: 1, respawnTime: 89 },
            { symbol: "OPALJJ", shipName: "Opal Jetjet", manufacturer: "Opal", spec: "Racer", class: "2", cargoCapacity: 863, fuelCapacity: 1797, ammoCapacity: 359, foodConsumptionRate: 0.067, ammoConsumptionRate: 0.040, miningRate: 0.810, subwarpSpeed: 0.0081, warpSpeed: 0.1, maxWarpDistance: 3.9, warpCoolDown: 120, warpFuelConsumptionRate: 55.82, subwarpFuelConsumptionRate: 15.34, planetExitFuelAmount: 15, scanCoolDown: 732, sduPerScan: 19, scanCost: 99, requiredCrew: 2, passengerCapacity: 0, respawnTime: 69 },
            { symbol: "PX5", shipName: "Pearce X5", manufacturer: "Pearce", spec: "Fighter", class: "2", cargoCapacity: 1107, fuelCapacity: 923, ammoCapacity: 1270, foodConsumptionRate: 0.067, ammoConsumptionRate: 0.050, miningRate: 0.990, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 3.8, warpCoolDown: 120, warpFuelConsumptionRate: 47.85, subwarpFuelConsumptionRate: 13.14, planetExitFuelAmount: 13, scanCoolDown: 756, sduPerScan: 18, scanCost: 99, requiredCrew: 2, passengerCapacity: 0, respawnTime: 96 },
            { symbol: "IMP1", shipName: "Armstrong IMP Tip", manufacturer: "Armstrong", spec: "Miner", class: "3", cargoCapacity: 9323, fuelCapacity: 4894, ammoCapacity: 1161, foodConsumptionRate: 0.161, ammoConsumptionRate: 0.000, miningRate: 6.207, subwarpSpeed: 0.0039, warpSpeed: 0.1, maxWarpDistance: 5.63, warpCoolDown: 180, warpFuelConsumptionRate: 170.36, subwarpFuelConsumptionRate: 46.8, planetExitFuelAmount: 47, scanCoolDown: 732, sduPerScan: 63, scanCost: 243, requiredCrew: 3, passengerCapacity: 1, respawnTime: 125 },
            { symbol: "THRILL", shipName: "Busan Thrill of Life", manufacturer: "Busan", spec: "Fighter", class: "3", cargoCapacity: 3832, fuelCapacity: 4023, ammoCapacity: 4396, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0070, warpSpeed: 0.1, maxWarpDistance: 4.8, warpCoolDown: 180, warpFuelConsumptionRate: 152.42, subwarpFuelConsumptionRate: 41.87, planetExitFuelAmount: 42, scanCoolDown: 678, sduPerScan: 59, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "CALMED", shipName: "Calico Medtech", manufacturer: "Calico", spec: "Rescue", class: "3", cargoCapacity: 4379, fuelCapacity: 6138, ammoCapacity: 1825, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.125, miningRate: 2.504, subwarpSpeed: 0.0055, warpSpeed: 0.1, maxWarpDistance: 5.1, warpCoolDown: 180, warpFuelConsumptionRate: 114.32, subwarpFuelConsumptionRate: 31.41, planetExitFuelAmount: 31, scanCoolDown: 696, sduPerScan: 64, scanCost: 161, requiredCrew: 2, passengerCapacity: 2, respawnTime: 134 },
            { symbol: "CALSHIP", shipName: "Calico Shipit", manufacturer: "Calico", spec: "Freight", class: "3", cargoCapacity: 11363, fuelCapacity: 4562, ammoCapacity: 622, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.114, miningRate: 2.276, subwarpSpeed: 0.0032, warpSpeed: 0.1, maxWarpDistance: 6.9, warpCoolDown: 180, warpFuelConsumptionRate: 114.32, subwarpFuelConsumptionRate: 31.41, planetExitFuelAmount: 31, scanCoolDown: 798, sduPerScan: 59, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 104 },
            { symbol: "FBLBEA", shipName: "Fimbul BYOS Earp", manufacturer: "Fimbul BYOS", spec: "Fighter", class: "3", cargoCapacity: 3832, fuelCapacity: 3193, ammoCapacity: 5225, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0077, warpSpeed: 0.1, maxWarpDistance: 5.03, warpCoolDown: 180, warpFuelConsumptionRate: 161.39, subwarpFuelConsumptionRate: 44.34, planetExitFuelAmount: 44, scanCoolDown: 732, sduPerScan: 57, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "OGKAMK", shipName: "Ogrika Mik", manufacturer: "Ogrika", spec: "Fighter", class: "3", cargoCapacity: 3832, fuelCapacity: 4023, ammoCapacity: 4396, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 4.8, warpCoolDown: 180, warpFuelConsumptionRate: 152.42, subwarpFuelConsumptionRate: 41.87, planetExitFuelAmount: 42, scanCoolDown: 732, sduPerScan: 57, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "OPALRF", shipName: "Opal Rayfam", manufacturer: "Opal", spec: "Data Runner", class: "3", cargoCapacity: 5640, fuelCapacity: 4147, ammoCapacity: 1659, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.126, miningRate: 2.524, subwarpSpeed: 0.0047, warpSpeed: 0.1, maxWarpDistance: 6.75, warpCoolDown: 180, warpFuelConsumptionRate: 118.8, subwarpFuelConsumptionRate: 32.64, planetExitFuelAmount: 33, scanCoolDown: 312, sduPerScan: 121, scanCost: 0, requiredCrew: 2, passengerCapacity: 1, respawnTime: 134 },
            { symbol: "PR6", shipName: "Pearce R6", manufacturer: "Pearce", spec: "Repair", class: "3", cargoCapacity: 7399, fuelCapacity: 5142, ammoCapacity: 995, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.114, miningRate: 2.286, subwarpSpeed: 0.0058, warpSpeed: 0.1, maxWarpDistance: 6, warpCoolDown: 180, warpFuelConsumptionRate: 112.08, subwarpFuelConsumptionRate: 30.79, planetExitFuelAmount: 31, scanCoolDown: 798, sduPerScan: 64, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 110 },
            { symbol: "PX6", shipName: "Pearce X6", manufacturer: "Pearce", spec: "Fighter", class: "3", cargoCapacity: 4661, fuelCapacity: 3193, ammoCapacity: 4396, foodConsumptionRate: 0.161, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 5.7, warpCoolDown: 180, warpFuelConsumptionRate: 147.94, subwarpFuelConsumptionRate: 40.64, planetExitFuelAmount: 41, scanCoolDown: 756, sduPerScan: 57, scanCost: 243, requiredCrew: 3, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "CHI", shipName: "Rainbow Chi", manufacturer: "Rainbow", spec: "Fighter", class: "3", cargoCapacity: 3832, fuelCapacity: 4023, ammoCapacity: 4396, foodConsumptionRate: 0.052, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0073, warpSpeed: 0.1, maxWarpDistance: 5.85, warpCoolDown: 180, warpFuelConsumptionRate: 138.97, subwarpFuelConsumptionRate: 38.18, planetExitFuelAmount: 38, scanCoolDown: 678, sduPerScan: 59, scanCost: 82, requiredCrew: 1, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "TUFAFE", shipName: "Tufa Feist", manufacturer: "Tufa", spec: "Fighter", class: "3", cargoCapacity: 3832, fuelCapacity: 3193, ammoCapacity: 5225, foodConsumptionRate: 0.108, ammoConsumptionRate: 0.153, miningRate: 3.062, subwarpSpeed: 0.0081, warpSpeed: 0.1, maxWarpDistance: 5.18, warpCoolDown: 180, warpFuelConsumptionRate: 145.7, subwarpFuelConsumptionRate: 40.03, planetExitFuelAmount: 40, scanCoolDown: 720, sduPerScan: 59, scanCost: 161, requiredCrew: 2, passengerCapacity: 1, respawnTime: 145 },
            { symbol: "VZUSAM", shipName: "VZUS ambwe", manufacturer: "VZUS", spec: "Bounty Hunter", class: "3", cargoCapacity: 4180, fuelCapacity: 4313, ammoCapacity: 4645, foodConsumptionRate: 0.161, ammoConsumptionRate: 0.149, miningRate: 2.979, subwarpSpeed: 0.0052, warpSpeed: 0.1, maxWarpDistance: 5.4, warpCoolDown: 180, warpFuelConsumptionRate: 138.97, subwarpFuelConsumptionRate: 38.18, planetExitFuelAmount: 38, scanCoolDown: 600, sduPerScan: 64, scanCost: 243, requiredCrew: 3, passengerCapacity: 1, respawnTime: 125 },
            { symbol: "IMP2", shipName: "Armstrong IMP Tap", manufacturer: "Armstrong", spec: "Miner", class: "4", cargoCapacity: 32270, fuelCapacity: 19810, ammoCapacity: 4019, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.000, miningRate: 19.192, subwarpSpeed: 0.0039, warpSpeed: 0.1, maxWarpDistance: 7.5, warpCoolDown: 240, warpFuelConsumptionRate: 526.72, subwarpFuelConsumptionRate: 144.7, planetExitFuelAmount: 145, scanCoolDown: 732, sduPerScan: 193, scanCost: 570, requiredCrew: 5, passengerCapacity: 3, respawnTime: 182 },
            { symbol: "CALATS", shipName: "Calico ATS Enforcer", manufacturer: "Calico", spec: "Fighter", class: "4", cargoCapacity: 16135, fuelCapacity: 13924, ammoCapacity: 15216, foodConsumptionRate: 0.153, ammoConsumptionRate: 0.473, miningRate: 9.468, subwarpSpeed: 0.0067, warpSpeed: 0.1, maxWarpDistance: 6.8, warpCoolDown: 240, warpFuelConsumptionRate: 464.35, subwarpFuelConsumptionRate: 127.57, planetExitFuelAmount: 128, scanCoolDown: 696, sduPerScan: 181, scanCost: 227, requiredCrew: 2, passengerCapacity: 0, respawnTime: 211 },
            { symbol: "CALCH", shipName: "Calico Compakt Hero", manufacturer: "Calico", spec: "Multi-Role", class: "4", cargoCapacity: 17341, fuelCapacity: 16652, ammoCapacity: 11484, foodConsumptionRate: 0.301, ammoConsumptionRate: 0.425, miningRate: 8.509, subwarpSpeed: 0.0061, warpSpeed: 0.1, maxWarpDistance: 7.2, warpCoolDown: 240, warpFuelConsumptionRate: 353.46, subwarpFuelConsumptionRate: 97.1, planetExitFuelAmount: 97, scanCoolDown: 606, sduPerScan: 193, scanCost: 454, requiredCrew: 4, passengerCapacity: 6, respawnTime: 182 },
            { symbol: "CALEV", shipName: "Calico Evac", manufacturer: "Calico", spec: "Rescue", class: "4", cargoCapacity: 18030, fuelCapacity: 15503, ammoCapacity: 6316, foodConsumptionRate: 0.528, ammoConsumptionRate: 0.387, miningRate: 7.741, subwarpSpeed: 0.0055, warpSpeed: 0.1, maxWarpDistance: 6.8, warpCoolDown: 240, warpFuelConsumptionRate: 353.46, subwarpFuelConsumptionRate: 97.1, planetExitFuelAmount: 97, scanCoolDown: 696, sduPerScan: 197, scanCost: 797, requiredCrew: 7, passengerCapacity: 8, respawnTime: 196 },
            { symbol: "FBLMAM", shipName: "Fimbul Mamba", manufacturer: "Fimbul", spec: "Bounty Hunter", class: "4", cargoCapacity: 17341, fuelCapacity: 14929, ammoCapacity: 16077, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.461, miningRate: 9.212, subwarpSpeed: 0.0049, warpSpeed: 0.1, maxWarpDistance: 6.6, warpCoolDown: 240, warpFuelConsumptionRate: 443.56, subwarpFuelConsumptionRate: 121.86, planetExitFuelAmount: 122, scanCoolDown: 666, sduPerScan: 193, scanCost: 570, requiredCrew: 5, passengerCapacity: 3, respawnTime: 182 },
            { symbol: "FBLMEX", shipName: "Fimbul Mamba EX", manufacturer: "Fimbul", spec: "Bounty Hunter", class: "4", cargoCapacity: 17341, fuelCapacity: 14929, ammoCapacity: 16077, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.461, miningRate: 9.212, subwarpSpeed: 0.0049, warpSpeed: 0.1, maxWarpDistance: 6.6, warpCoolDown: 240, warpFuelConsumptionRate: 443.56, subwarpFuelConsumptionRate: 121.86, planetExitFuelAmount: 122, scanCoolDown: 666, sduPerScan: 193, scanCost: 570, requiredCrew: 5, passengerCapacity: 3, respawnTime: 182 },
            { symbol: "FBLBPL", shipName: "Fimbul BYOS Packlite", manufacturer: "Fimbul BYOS", spec: "Freight", class: "4", cargoCapacity: 45074, fuelCapacity: 18661, ammoCapacity: 2153, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.352, miningRate: 7.037, subwarpSpeed: 0.0048, warpSpeed: 0.1, maxWarpDistance: 9.5, warpCoolDown: 240, warpFuelConsumptionRate: 388.11, subwarpFuelConsumptionRate: 106.62, planetExitFuelAmount: 107, scanCoolDown: 846, sduPerScan: 177, scanCost: 570, requiredCrew: 5, passengerCapacity: 4, respawnTime: 151 },
            { symbol: "FBLBRA", shipName: "Fimbul BYOS Ranger", manufacturer: "Fimbul BYOS", spec: "Data Runner", class: "4", cargoCapacity: 16652, fuelCapacity: 20097, ammoCapacity: 5742, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.390, miningRate: 7.805, subwarpSpeed: 0.0065, warpSpeed: 0.1, maxWarpDistance: 8.3, warpCoolDown: 240, warpFuelConsumptionRate: 388.11, subwarpFuelConsumptionRate: 106.62, planetExitFuelAmount: 107, scanCoolDown: 300, sduPerScan: 378, scanCost: 0, requiredCrew: 5, passengerCapacity: 3, respawnTime: 196 },
            { symbol: "OGKATU", shipName: "Ogrika Tursic", manufacturer: "Ogrika", spec: "Fighter", class: "4", cargoCapacity: 13264, fuelCapacity: 13924, ammoCapacity: 18087, foodConsumptionRate: 0.301, ammoConsumptionRate: 0.473, miningRate: 9.468, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 6.8, warpCoolDown: 240, warpFuelConsumptionRate: 471.28, subwarpFuelConsumptionRate: 129.47, planetExitFuelAmount: 129, scanCoolDown: 732, sduPerScan: 177, scanCost: 454, requiredCrew: 4, passengerCapacity: 3, respawnTime: 211 },
            { symbol: "PF4", shipName: "Pearce F4", manufacturer: "Pearce", spec: "Fighter", class: "4", cargoCapacity: 16135, fuelCapacity: 13924, ammoCapacity: 15216, foodConsumptionRate: 0.301, ammoConsumptionRate: 0.473, miningRate: 9.468, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 7.6, warpCoolDown: 240, warpFuelConsumptionRate: 457.42, subwarpFuelConsumptionRate: 125.66, planetExitFuelAmount: 126, scanCoolDown: 756, sduPerScan: 177, scanCost: 454, requiredCrew: 4, passengerCapacity: 3, respawnTime: 211 },
            { symbol: "OM", shipName: "Rainbow Om", manufacturer: "Rainbow", spec: "Freight", class: "4", cargoCapacity: 39332, fuelCapacity: 18661, ammoCapacity: 2153, foodConsumptionRate: 0.301, ammoConsumptionRate: 0.352, miningRate: 7.037, subwarpSpeed: 0.0038, warpSpeed: 0.1, maxWarpDistance: 10.2, warpCoolDown: 240, warpFuelConsumptionRate: 318.81, subwarpFuelConsumptionRate: 87.58, planetExitFuelAmount: 88, scanCoolDown: 774, sduPerScan: 181, scanCost: 454, requiredCrew: 4, passengerCapacity: 4, respawnTime: 151 },
            { symbol: "VZUSOP", shipName: "VZUS opod", manufacturer: "VZUS", spec: "Data Runner", class: "4", cargoCapacity: 13781, fuelCapacity: 22968, ammoCapacity: 5742, foodConsumptionRate: 0.380, ammoConsumptionRate: 0.390, miningRate: 7.805, subwarpSpeed: 0.0047, warpSpeed: 0.1, maxWarpDistance: 8.4, warpCoolDown: 240, warpFuelConsumptionRate: 374.25, subwarpFuelConsumptionRate: 102.82, planetExitFuelAmount: 103, scanCoolDown: 300, sduPerScan: 378, scanCost: 0, requiredCrew: 5, passengerCapacity: 3, respawnTime: 196 },
            { symbol: "PMR8", shipName: "Pearce MR8", manufacturer: "Pearce", spec: "Multi-Role", class: "5", cargoCapacity: 90914, fuelCapacity: 65091, ammoCapacity: 34710, foodConsumptionRate: 0.236, ammoConsumptionRate: 1.254, miningRate: 25.078, subwarpSpeed: 0.0051, warpSpeed: 0.1, maxWarpDistance: 10.1, warpCoolDown: 300, warpFuelConsumptionRate: 1221.43, subwarpFuelConsumptionRate: 336, planetExitFuelAmount: 336, scanCoolDown: 753, sduPerScan: 563, scanCost: 355, requiredCrew: 16, passengerCapacity: 19, respawnTime: 256 },
            { symbol: "FBLBBU", shipName: "Fimbul BYOS Butch", manufacturer: "Fimbul BYOS", spec: "Fighter", class: "5", cargoCapacity: 45911, fuelCapacity: 58135, ammoCapacity: 72544, foodConsumptionRate: 1.483, ammoConsumptionRate: 1.464, miningRate: 29.275, subwarpSpeed: 0.0071, warpSpeed: 0.1, maxWarpDistance: 8.38, warpCoolDown: 300, warpFuelConsumptionRate: 1542.87, subwarpFuelConsumptionRate: 423.86, planetExitFuelAmount: 424, scanCoolDown: 732, sduPerScan: 547, scanCost: 2235, requiredCrew: 15, passengerCapacity: 11, respawnTime: 293 },
            { symbol: "FBLEGR", shipName: "Fimbul ECOS Greenader", manufacturer: "Fimbul ECOS", spec: "Bomber", class: "5", cargoCapacity: 59228, fuelCapacity: 58135, ammoCapacity: 58135, foodConsumptionRate: 1.980, ammoConsumptionRate: 1.484, miningRate: 29.670, subwarpSpeed: 0.0041, warpSpeed: 0.1, maxWarpDistance: 8.5, warpCoolDown: 300, warpFuelConsumptionRate: 1414.29, subwarpFuelConsumptionRate: 388.54, planetExitFuelAmount: 389, scanCoolDown: 636, sduPerScan: 585, scanCost: 2980, requiredCrew: 20, passengerCapacity: 11, respawnTime: 293 },
            { symbol: "OGKASP", shipName: "Ogrika Sunpaa", manufacturer: "Ogrika", spec: "Freight", class: "5", cargoCapacity: 156019, fuelCapacity: 64594, ammoCapacity: 7453, foodConsumptionRate: 1.883, ammoConsumptionRate: 1.088, miningRate: 21.758, subwarpSpeed: 0.0035, warpSpeed: 0.1, maxWarpDistance: 11.5, warpCoolDown: 300, warpFuelConsumptionRate: 1114.29, subwarpFuelConsumptionRate: 306.12, planetExitFuelAmount: 306, scanCoolDown: 828, sduPerScan: 560, scanCost: 2828, requiredCrew: 19, passengerCapacity: 15, respawnTime: 209 },
            { symbol: "OGKATP", shipName: "Ogrika Thripid", manufacturer: "Ogrika", spec: "Fighter", class: "5", cargoCapacity: 45911, fuelCapacity: 58135, ammoCapacity: 72544, foodConsumptionRate: 1.090, ammoConsumptionRate: 1.464, miningRate: 29.275, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 8, warpCoolDown: 300, warpFuelConsumptionRate: 1457.15, subwarpFuelConsumptionRate: 400.32, planetExitFuelAmount: 400, scanCoolDown: 732, sduPerScan: 547, scanCost: 1642, requiredCrew: 11, passengerCapacity: 11, respawnTime: 293 },
            { symbol: "OPALBB", shipName: "Opal Bitboat", manufacturer: "Opal", spec: "Transport", class: "5", cargoCapacity: 81488, fuelCapacity: 57638, ammoCapacity: 11925, foodConsumptionRate: 2.076, ammoConsumptionRate: 1.098, miningRate: 21.956, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 11.75, warpCoolDown: 300, warpFuelConsumptionRate: 1135.72, subwarpFuelConsumptionRate: 312.01, planetExitFuelAmount: 312, scanCoolDown: 744, sduPerScan: 560, scanCost: 3132, requiredCrew: 21, passengerCapacity: 60, respawnTime: 271 },
            { symbol: "PR8", shipName: "Pearce R8", manufacturer: "Pearce", spec: "Refuel/Repair", class: "5", cargoCapacity: 91823, fuelCapacity: 94407, ammoCapacity: 12919, foodConsumptionRate: 1.483, ammoConsumptionRate: 1.093, miningRate: 21.857, subwarpSpeed: 0.0047, warpSpeed: 0.1, maxWarpDistance: 10, warpCoolDown: 300, warpFuelConsumptionRate: 900, subwarpFuelConsumptionRate: 247.25, planetExitFuelAmount: 247, scanCoolDown: 828, sduPerScan: 585, scanCost: 2235, requiredCrew: 15, passengerCapacity: 9, respawnTime: 222 },
            { symbol: "ARC", shipName: "Rainbow Arc", manufacturer: "Rainbow", spec: "Freight", class: "5", cargoCapacity: 156019, fuelCapacity: 64594, ammoCapacity: 7453, foodConsumptionRate: 1.387, ammoConsumptionRate: 1.088, miningRate: 21.758, subwarpSpeed: 0.0038, warpSpeed: 0.1, maxWarpDistance: 12.75, warpCoolDown: 300, warpFuelConsumptionRate: 985.72, subwarpFuelConsumptionRate: 270.8, planetExitFuelAmount: 271, scanCoolDown: 774, sduPerScan: 560, scanCost: 2083, requiredCrew: 14, passengerCapacity: 15, respawnTime: 209 },
            { symbol: "IMP3", shipName: "Armstrong IMP", manufacturer: "Armstrong", spec: "Miner", class: "6", cargoCapacity: 524220, fuelCapacity: 237344, ammoCapacity: 48157, foodConsumptionRate: 5.297, ammoConsumptionRate: 0.000, miningRate: 183.477, subwarpSpeed: 0.0039, warpSpeed: 0.1, maxWarpDistance: 11.25, warpCoolDown: 420, warpFuelConsumptionRate: 5035.43, subwarpFuelConsumptionRate: 1383.36, planetExitFuelAmount: 1383, scanCoolDown: 732, sduPerScan: 1848, scanCost: 7976, requiredCrew: 43, passengerCapacity: 37, respawnTime: 334 },
            { symbol: "HEART", shipName: "Busan Maiden Heart", manufacturer: "Busan", spec: "Fighter", class: "6", cargoCapacity: 227712, fuelCapacity: 201226, ammoCapacity: 251103, foodConsumptionRate: 6.285, ammoConsumptionRate: 4.526, miningRate: 90.515, subwarpSpeed: 0.0070, warpSpeed: 0.1, maxWarpDistance: 9.6, warpCoolDown: 420, warpFuelConsumptionRate: 4505.38, subwarpFuelConsumptionRate: 1237.74, planetExitFuelAmount: 1238, scanCoolDown: 678, sduPerScan: 1730, scanCost: 9462, requiredCrew: 51, passengerCapacity: 37, respawnTime: 388 },
            { symbol: "CALG", shipName: "Calico Guardian", manufacturer: "Calico", spec: "Multi-Role", class: "6", cargoCapacity: 242159, fuelCapacity: 233904, ammoCapacity: 171988, foodConsumptionRate: 5.787, ammoConsumptionRate: 4.067, miningRate: 81.342, subwarpSpeed: 0.0061, warpSpeed: 0.1, maxWarpDistance: 10.8, warpCoolDown: 420, warpFuelConsumptionRate: 3379.04, subwarpFuelConsumptionRate: 928.31, planetExitFuelAmount: 928, scanCoolDown: 618, sduPerScan: 1809, scanCost: 8715, requiredCrew: 47, passengerCapacity: 82, respawnTime: 334 },
            { symbol: "FBLSLE", shipName: "Fimbul Sledbarge", manufacturer: "Fimbul", spec: "Freight", class: "6", cargoCapacity: 608838, fuelCapacity: 223585, ammoCapacity: 25798, foodConsumptionRate: 5.048, ammoConsumptionRate: 3.364, miningRate: 67.275, subwarpSpeed: 0.0026, warpSpeed: 0.1, maxWarpDistance: 13.5, warpCoolDown: 420, warpFuelConsumptionRate: 3710.31, subwarpFuelConsumptionRate: 1019.32, planetExitFuelAmount: 1019, scanCoolDown: 882, sduPerScan: 1691, scanCost: 7607, requiredCrew: 41, passengerCapacity: 52, respawnTime: 277 },
            { symbol: "FBLEBO", shipName: "Fimbul ECOS Bombarella", manufacturer: "Fimbul ECOS", spec: "Bomber", class: "6", cargoCapacity: 205010, fuelCapacity: 201226, ammoCapacity: 270022, foodConsumptionRate: 7.762, ammoConsumptionRate: 4.587, miningRate: 91.739, subwarpSpeed: 0.0041, warpSpeed: 0.1, maxWarpDistance: 10.2, warpCoolDown: 420, warpFuelConsumptionRate: 4372.87, subwarpFuelConsumptionRate: 1201.34, planetExitFuelAmount: 1201, scanCoolDown: 636, sduPerScan: 1809, scanCost: 11685, requiredCrew: 63, passengerCapacity: 37, respawnTime: 388 },
            { symbol: "OGKAJA", shipName: "Ogrika Jod Asteris", manufacturer: "Ogrika", spec: "Transport", class: "6", cargoCapacity: 316458, fuelCapacity: 233904, ammoCapacity: 41277, foodConsumptionRate: 7.762, ammoConsumptionRate: 3.394, miningRate: 67.887, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 12, warpCoolDown: 420, warpFuelConsumptionRate: 3445.29, subwarpFuelConsumptionRate: 946.51, planetExitFuelAmount: 947, scanCoolDown: 732, sduPerScan: 1691, scanCost: 11685, requiredCrew: 63, passengerCapacity: 208, respawnTime: 359 },
            { symbol: "PC9", shipName: "Pearce C9", manufacturer: "Pearce", spec: "Fighter", class: "6", cargoCapacity: 227712, fuelCapacity: 201226, ammoCapacity: 251103, foodConsumptionRate: 7.272, ammoConsumptionRate: 4.526, miningRate: 90.515, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 11.4, warpCoolDown: 420, warpFuelConsumptionRate: 4372.87, subwarpFuelConsumptionRate: 1201.34, planetExitFuelAmount: 1201, scanCoolDown: 756, sduPerScan: 1691, scanCost: 10938, requiredCrew: 59, passengerCapacity: 37, respawnTime: 388 },
            { symbol: "PD9", shipName: "Pearce D9", manufacturer: "Pearce", spec: "Salvage", class: "6", cargoCapacity: 553114, fuelCapacity: 189187, ammoCapacity: 72235, foodConsumptionRate: 5.048, ammoConsumptionRate: 3.670, miningRate: 73.391, subwarpSpeed: 0.0041, warpSpeed: 0.1, maxWarpDistance: 11.4, warpCoolDown: 420, warpFuelConsumptionRate: 3842.83, subwarpFuelConsumptionRate: 1055.72, planetExitFuelAmount: 1056, scanCoolDown: 816, sduPerScan: 1848, scanCost: 7607, requiredCrew: 41, passengerCapacity: 19, respawnTime: 294 },
            { symbol: "VZUSBA", shipName: "VZUS ballad", manufacturer: "VZUS", spec: "Fighter", class: "6", cargoCapacity: 227712, fuelCapacity: 201226, ammoCapacity: 251103, foodConsumptionRate: 6.285, ammoConsumptionRate: 4.526, miningRate: 90.515, subwarpSpeed: 0.0058, warpSpeed: 0.1, maxWarpDistance: 10.2, warpCoolDown: 420, warpFuelConsumptionRate: 4637.89, subwarpFuelConsumptionRate: 1274.15, planetExitFuelAmount: 1274, scanCoolDown: 732, sduPerScan: 1691, scanCost: 9462, requiredCrew: 51, passengerCapacity: 37, respawnTime: 388 },
            { symbol: "FBLBTA", shipName: "Fimbul BYOS Tankship", manufacturer: "Fimbul BYOS", spec: "Fighter", class: "7", cargoCapacity: 788200, fuelCapacity: 696521, ammoCapacity: 1107290, foodConsumptionRate: 11.270, ammoConsumptionRate: 13.993, miningRate: 279.865, subwarpSpeed: 0.0077, warpSpeed: 0.1, maxWarpDistance: 11.73, warpCoolDown: 540, warpFuelConsumptionRate: 14749.67, subwarpFuelConsumptionRate: 4052.11, planetExitFuelAmount: 4052, scanCoolDown: 732, sduPerScan: 5227, scanCost: 16963, requiredCrew: 76, passengerCapacity: 129, respawnTime: 494 },
            { symbol: "FBLETR", shipName: "Fimbul ECOS Treearrow", manufacturer: "Fimbul ECOS", spec: "Bomber", class: "7", cargoCapacity: 828682, fuelCapacity: 696521, ammoCapacity: 934648, foodConsumptionRate: 17.489, ammoConsumptionRate: 14.182, miningRate: 283.647, subwarpSpeed: 0.0041, warpSpeed: 0.1, maxWarpDistance: 11.9, warpCoolDown: 540, warpFuelConsumptionRate: 13520.53, subwarpFuelConsumptionRate: 3714.43, planetExitFuelAmount: 3714, scanCoolDown: 636, sduPerScan: 5592, scanCost: 26332, requiredCrew: 118, passengerCapacity: 180, respawnTime: 494 },
            { symbol: "PC11", shipName: "Pearce C11", manufacturer: "Pearce", spec: "Fighter", class: "7", cargoCapacity: 788200, fuelCapacity: 696521, ammoCapacity: 1107290, foodConsumptionRate: 16.157, ammoConsumptionRate: 13.993, miningRate: 279.865, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 13.3, warpCoolDown: 540, warpFuelConsumptionRate: 13520.53, subwarpFuelConsumptionRate: 3714.43, planetExitFuelAmount: 3714, scanCoolDown: 756, sduPerScan: 5227, scanCost: 24318, requiredCrew: 109, passengerCapacity: 129, respawnTime: 494 },
            { symbol: "STAND", shipName: "Busan The Last Stand mk. VIII", manufacturer: "Busan", spec: "Fighter", class: "9", cargoCapacity: 12296610, fuelCapacity: 8345147, ammoCapacity: 13266644, foodConsumptionRate: 53.115, ammoConsumptionRate: 133.775, miningRate: 2675.491, subwarpSpeed: 0.0070, warpSpeed: 0.1, maxWarpDistance: 14.4, warpCoolDown: 780, warpFuelConsumptionRate: 133171.97, subwarpFuelConsumptionRate: 36585.71, planetExitFuelAmount: 36586, scanCoolDown: 678, sduPerScan: 51134, scanCost: 79945, requiredCrew: 265, passengerCapacity: 2773, respawnTime: 740 },
            { symbol: "GALLOW", shipName: "Fimbul BYOS Gallowspine", manufacturer: "Fimbul BYOS", spec: "Fighter", class: "9", cargoCapacity: 16576173, fuelCapacity: 8345147, ammoCapacity: 13266644, foodConsumptionRate: 47.305, ammoConsumptionRate: 133.775, miningRate: 2675.491, subwarpSpeed: 0.0074, warpSpeed: 0.1, maxWarpDistance: 17.17, warpCoolDown: 780, warpFuelConsumptionRate: 141005.62, subwarpFuelConsumptionRate: 38737.81, planetExitFuelAmount: 38738, scanCoolDown: 732, sduPerScan: 52457, scanCost: 76383, requiredCrew: 236, passengerCapacity: 2773, respawnTime: 740 },
            { symbol: "SUPER", shipName: "Fimbul ECOS Superphoenix", manufacturer: "Fimbul ECOS", spec: "Bomber", class: "9", cargoCapacity: 9928586, fuelCapacity: 9771668, ammoCapacity: 14051231, foodConsumptionRate: 69.540, ammoConsumptionRate: 135.582, miningRate: 2711.646, subwarpSpeed: 0.0041, warpSpeed: 0.1, maxWarpDistance: 15.3, warpCoolDown: 780, warpFuelConsumptionRate: 129255.15, subwarpFuelConsumptionRate: 35509.66, planetExitFuelAmount: 35510, scanCoolDown: 636, sduPerScan: 53458, scanCost: 104680, requiredCrew: 347, passengerCapacity: 2773, respawnTime: 740 },
            { symbol: "T1TAN", shipName: "Pearce T1", manufacturer: "Pearce", spec: "Fighter", class: "9", cargoCapacity: 12296610, fuelCapacity: 8345147, ammoCapacity: 13266644, foodConsumptionRate: 42.486, ammoConsumptionRate: 133.775, miningRate: 2675.491, subwarpSpeed: 0.0064, warpSpeed: 0.1, maxWarpDistance: 17.1, warpCoolDown: 780, warpFuelConsumptionRate: 129255.15, subwarpFuelConsumptionRate: 35509.66, planetExitFuelAmount: 35510, scanCoolDown: 756, sduPerScan: 49972, scanCost: 63953, requiredCrew: 212, passengerCapacity: 2773, respawnTime: 740 },
            { symbol: "PHI", shipName: "Rainbow Phi", manufacturer: "Rainbow", spec: "Fighter", class: "9", cargoCapacity: 15149652, fuelCapacity: 9771668, ammoCapacity: 8987082, foodConsumptionRate: 51.104, ammoConsumptionRate: 133.775, miningRate: 2675.491, subwarpSpeed: 0.0073, warpSpeed: 0.1, maxWarpDistance: 17.55, warpCoolDown: 780, warpFuelConsumptionRate: 121421.5, subwarpFuelConsumptionRate: 33357.56, planetExitFuelAmount: 33358, scanCoolDown: 696, sduPerScan: 51134, scanCost: 76928, requiredCrew: 255, passengerCapacity: 2773, respawnTime: 740 }
        ];

        // ═══════════════════════════════════════════════════════
        // SAGE Fleet Optimizer Data
        // ═══════════════════════════════════════════════════════
        
        const SAGE_SHIPS = {
            // Class 1 Ships
            "OGKARU": {
                name: "Ogrika Ruch",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 249,
                fuel: 450,
                ammo: 104,
                mining: 2620,
                speed: 7600,
                price: 4990,
                type: "Racer"
            },
            "OPALJ": {
                name: "Opal Jet",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 249,
                fuel: 450,
                ammo: 104,
                mining: 2620,
                speed: 8100,
                price: 3990,
                type: "Racer"
            },
            "FBLAIR": {
                name: "Fimbul Airbike",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 249,
                fuel: 450,
                ammo: 104,
                mining: 2620,
                speed: 8400,
                price: 2990,
                type: "Racer"
            },
            "VZUSSO": {
                name: "VZUS solos",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 249,
                fuel: 450,
                ammo: 104,
                mining: 2620,
                speed: 7600,
                price: 4410,
                type: "Racer"
            },
            "PULSE": {
                name: "Busan Pulse",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 249,
                fuel: 450,
                ammo: 104,
                mining: 2620,
                speed: 8600,
                price: null,
                type: "Racer"
            },
            "PX4": {
                name: "Pearce X4",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 389,
                fuel: 267,
                ammo: 228,
                mining: 3200,
                speed: 7000,
                price: 7800,
                type: "Fighter"
            },
            "FBLEUN": {
                name: "Fimbul ECOS Unibomba",
                class: 1,
                points: 1,
                crew: 1,
                cargo: 274,
                fuel: 267,
                ammo: 336,
                mining: 3250,
                speed: 5200,
                price: 8490,
                type: "Bomber"
            },
            
            // Class 2 Ships
            "CALMAX": {
                name: "Calico Maxhog",
                class: 2,
                points: 4,
                crew: 1,
                cargo: 2205,
                fuel: 1150,
                ammo: 288,
                mining: 7430,
                speed: 6700,
                price: 39400,
                type: "Transport"
            },
            "OPALJJ": {
                name: "Opal Jetjet",
                class: 2,
                points: 4,
                crew: 2,
                cargo: 863,
                fuel: 1797,
                ammo: 359,
                mining: 8100,
                speed: 8100,
                price: 34900,
                type: "Racer"
            },
            "FBLLOW": {
                name: "Fimbul Lowbie",
                class: 2,
                points: 4,
                crew: 1,
                cargo: 1965,
                fuel: 1390,
                ammo: 288,
                mining: 7430,
                speed: 6100,
                price: 39000,
                type: "Transport"
            },
            "OGKANR": {
                name: "Ogrika Niruch",
                class: 2,
                points: 4,
                crew: 1,
                cargo: 1965,
                fuel: 1390,
                ammo: 288,
                mining: 7430,
                speed: 6400,
                price: 118990,
                type: "Transport"
            },
            "CALSCD": {
                name: "Calico Scud",
                class: 2,
                points: 4,
                crew: 1,
                cargo: 863,
                fuel: 1797,
                ammo: 359,
                mining: 8100,
                speed: 7800,
                price: 119000,
                type: "Racer"
            },
            "PX5": {
                name: "Pearce X5",
                class: 2,
                points: 4,
                crew: 2,
                cargo: 1107,
                fuel: 923,
                ammo: 1270,
                mining: 9900,
                speed: 6400,
                price: 69000,
                type: "Fighter"
            },
            
            // Class 3 Ships
            "OGKAMK": {
                name: "Ogrika Mik",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 3832,
                fuel: 4023,
                ammo: 4396,
                mining: 30620,
                speed: 6400,
                price: 199000,
                type: "Fighter"
            },
            "VZUSAM": {
                name: "VZUS ambwe",
                class: 3,
                points: 9,
                crew: 3,
                cargo: 4180,
                fuel: 4313,
                ammo: 4645,
                mining: 29790,
                speed: 5200,
                price: 199000,
                type: "Bounty Hunter"
            },
            "CHI": {
                name: "Rainbow Chi",
                class: 3,
                points: 9,
                crew: 1,
                cargo: 3832,
                fuel: 4023,
                ammo: 4396,
                mining: 30620,
                speed: 7300,
                price: 137900,
                type: "Fighter"
            },
            "CALSHIP": {
                name: "Calico Shipit",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 11363,
                fuel: 4562,
                ammo: 622,
                mining: 22760,
                speed: 3200,
                price: null,
                type: "Freighter"
            },
            "PR6": {
                name: "Pearce R6",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 7399,
                fuel: 5142,
                ammo: 995,
                mining: 22860,
                speed: 5800,
                price: 590000,
                type: "Repair"
            },
            "THRILL": {
                name: "Busan Thrill of Life",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 3832,
                fuel: 4023,
                ammo: 4396,
                mining: 30620,
                speed: 7000,
                price: 690000,
                type: "Fighter"
            },
            "CALMED": {
                name: "Calico Medtech",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 4379,
                fuel: 6138,
                ammo: 1825,
                mining: 25040,
                speed: 5500,
                price: 499000,
                type: "Rescue"
            },
            "IMP1": {
                name: "Armstrong IMP Tip",
                class: 3,
                points: 9,
                crew: 3,
                cargo: 9323,
                fuel: 4894,
                ammo: 1161,
                mining: 62070,
                speed: 3900,
                price: 690000,
                type: "Miner"
            },
            "TUFAFE": {
                name: "Tufa Feist",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 3832,
                fuel: 3193,
                ammo: 5225,
                mining: 30620,
                speed: 8100,
                price: 188000,
                type: "Fighter"
            },
            "FBLBEA": {
                name: "Fimbul BYOS Earp",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 3832,
                fuel: 3193,
                ammo: 5225,
                mining: 30620,
                speed: 7700,
                price: 199000,
                type: "Fighter"
            },
            "OPALRF": {
                name: "Opal Rayfam",
                class: 3,
                points: 9,
                crew: 2,
                cargo: 5640,
                fuel: 4147,
                ammo: 1659,
                mining: 25240,
                speed: 4700,
                price: 890000,
                type: "Data Runner"
            },
            "PX6": {
                name: "Pearce X6",
                class: 3,
                points: 9,
                crew: 3,
                cargo: 4661,
                fuel: 3193,
                ammo: 4396,
                mining: 30620,
                speed: 6400,
                price: 199000,
                type: "Fighter"
            },
            
            // Class 4 Ships
            "OGKATU": {
                name: "Ogrika Tursic",
                class: 4,
                points: 16,
                crew: 4,
                cargo: 13264,
                fuel: 13924,
                ammo: 18087,
                mining: 94680,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "OM": {
                name: "Rainbow Om",
                class: 4,
                points: 16,
                crew: 4,
                cargo: 39332,
                fuel: 18661,
                ammo: 2153,
                mining: 70370,
                speed: 3800,
                price: null,
                type: "Freighter"
            },
            "PF4": {
                name: "Pearce F4",
                class: 4,
                points: 16,
                crew: 4,
                cargo: 16135,
                fuel: 13924,
                ammo: 15216,
                mining: 94680,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "CALEV": {
                name: "Calico Evac",
                class: 4,
                points: 16,
                crew: 7,
                cargo: 18030,
                fuel: 15503,
                ammo: 6316,
                mining: 77410,
                speed: 5500,
                price: null,
                type: "Rescue"
            },
            "CALATS": {
                name: "Calico ATS Enforcer",
                class: 4,
                points: 16,
                crew: 2,
                cargo: 16135,
                fuel: 13924,
                ammo: 15216,
                mining: 94680,
                speed: 6700,
                price: null,
                type: "Fighter"
            },
            "FBLBRA": {
                name: "Fimbul BYOS Ranger",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 16652,
                fuel: 20097,
                ammo: 5742,
                mining: 78050,
                speed: 6500,
                price: null,
                type: "Data Runner"
            },
            "FBLMEX": {
                name: "Fimbul Mamba EX",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 17341,
                fuel: 14929,
                ammo: 16077,
                mining: 92120,
                speed: 4900,
                price: 399900,
                type: "Bounty Hunter"
            },
            "IMP2": {
                name: "Armstrong IMP Tap",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 32270,
                fuel: 19810,
                ammo: 4019,
                mining: 191920,
                speed: 3900,
                price: null,
                type: "Miner"
            },
            "VZUSOP": {
                name: "VZUS opod",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 13781,
                fuel: 22968,
                ammo: 5742,
                mining: 78050,
                speed: 4700,
                price: null,
                type: "Data Runner"
            },
            "FBLBPL": {
                name: "Fimbul BYOS Packlite",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 45074,
                fuel: 18661,
                ammo: 2153,
                mining: 70370,
                speed: 4800,
                price: null,
                type: "Freighter"
            },
            "CALCH": {
                name: "Calico Compakt Hero",
                class: 4,
                points: 16,
                crew: 4,
                cargo: 17341,
                fuel: 16652,
                ammo: 11484,
                mining: 85090,
                speed: 6100,
                price: null,
                type: "Multi-role"
            },
            "FBLMAM": {
                name: "Fimbul Mamba",
                class: 4,
                points: 16,
                crew: 5,
                cargo: 17341,
                fuel: 14929,
                ammo: 16077,
                mining: 92120,
                speed: 4900,
                price: null,
                type: "Bounty Hunter"
            },
            
            // Class 5 Ships
            "ARC": {
                name: "Rainbow Arc",
                class: 5,
                points: 25,
                crew: 14,
                cargo: 156019,
                fuel: 64594,
                ammo: 7453,
                mining: 217580,
                speed: 3800,
                price: null,
                type: "Freighter"
            },
            "PMR8": {
                name: "Pearce MR8",
                class: 5,
                points: 25,
                crew: 16,
                cargo: 90914,
                fuel: 65091,
                ammo: 34710,
                mining: 250780,
                speed: 5100,
                price: null,
                type: "Multi-role"
            },
            "OGKATP": {
                name: "Ogrika Thripid",
                class: 5,
                points: 25,
                crew: 11,
                cargo: 45911,
                fuel: 58135,
                ammo: 72544,
                mining: 292750,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "OGKASP": {
                name: "Ogrika Sunpaa",
                class: 5,
                points: 25,
                crew: 19,
                cargo: 156019,
                fuel: 64594,
                ammo: 7453,
                mining: 217580,
                speed: 3500,
                price: null,
                type: "Freighter"
            },
            "FBLBBU": {
                name: "Fimbul BYOS Butch",
                class: 5,
                points: 25,
                crew: 15,
                cargo: 45911,
                fuel: 58135,
                ammo: 72544,
                mining: 292750,
                speed: 7100,
                price: null,
                type: "Fighter"
            },
            "PR8": {
                name: "Pearce R8",
                class: 5,
                points: 25,
                crew: 15,
                cargo: 91823,
                fuel: 94407,
                ammo: 12919,
                mining: 218570,
                speed: 4700,
                price: null,
                type: "Refuel/Repair"
            },
            "FBLEGR": {
                name: "Fimbul ECOS Greenader",
                class: 5,
                points: 25,
                crew: 20,
                cargo: 59228,
                fuel: 58135,
                ammo: 58135,
                mining: 296700,
                speed: 4100,
                price: null,
                type: "Bomber"
            },
            "OPALBB": {
                name: "Opal Bitboat",
                class: 5,
                points: 25,
                crew: 21,
                cargo: 81488,
                fuel: 57638,
                ammo: 11925,
                mining: 219560,
                speed: 6400,
                price: null,
                type: "Transport"
            },
            
            // Class 6 Ships
            "CALG": {
                name: "Calico Guardian",
                class: 6,
                points: 36,
                crew: 47,
                cargo: 242159,
                fuel: 233904,
                ammo: 171988,
                mining: 813420,
                speed: 6100,
                price: null,
                type: "Multi-role"
            },
            "PC9": {
                name: "Pearce C9",
                class: 6,
                points: 36,
                crew: 59,
                cargo: 227712,
                fuel: 201226,
                ammo: 251103,
                mining: 905150,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "HEART": {
                name: "Busan Maiden Heart",
                class: 6,
                points: 36,
                crew: 51,
                cargo: 227712,
                fuel: 201226,
                ammo: 251103,
                mining: 905150,
                speed: 7000,
                price: null,
                type: "Fighter"
            },
            "VZUSBA": {
                name: "VZUS ballad",
                class: 6,
                points: 36,
                crew: 51,
                cargo: 227712,
                fuel: 201226,
                ammo: 251103,
                mining: 905150,
                speed: 5800,
                price: null,
                type: "Fighter"
            },
            "OGKAJA": {
                name: "Ogrika Jod Asteris",
                class: 6,
                points: 36,
                crew: 63,
                cargo: 316458,
                fuel: 233904,
                ammo: 41277,
                mining: 678870,
                speed: 6400,
                price: null,
                type: "Transport"
            },
            "IMP3": {
                name: "Armstrong IMP",
                class: 6,
                points: 36,
                crew: 43,
                cargo: 524220,
                fuel: 237344,
                ammo: 48157,
                mining: 1834770,
                speed: 3900,
                price: null,
                type: "Miner"
            },
            "FBLSLE": {
                name: "Fimbul Sledbarge",
                class: 6,
                points: 36,
                crew: 41,
                cargo: 608838,
                fuel: 223585,
                ammo: 25798,
                mining: 672750,
                speed: 2600,
                price: null,
                type: "Freighter"
            },
            "FBLEBO": {
                name: "Fimbul ECOS Bombarella",
                class: 6,
                points: 36,
                crew: 63,
                cargo: 205010,
                fuel: 201226,
                ammo: 270022,
                mining: 917390,
                speed: 4100,
                price: null,
                type: "Bomber"
            },
            "PD9": {
                name: "Pearce D9",
                class: 6,
                points: 36,
                crew: 41,
                cargo: 553114,
                fuel: 189187,
                ammo: 72235,
                mining: 733910,
                speed: 4100,
                price: null,
                type: "Salvage"
            },
            
            // Class 7 Ships
            "FBLETR": {
                name: "Fimbul ECOS Treearrow",
                class: 7,
                points: 49,
                crew: 118,
                cargo: 828682,
                fuel: 696521,
                ammo: 934648,
                mining: 2836470,
                speed: 4100,
                price: null,
                type: "Bomber"
            },
            "PC11": {
                name: "Pearce C11",
                class: 7,
                points: 49,
                crew: 109,
                cargo: 788200,
                fuel: 696521,
                ammo: 1107290,
                mining: 2798650,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "FBLBTA": {
                name: "Fimbul BYOS Tankship",
                class: 7,
                points: 49,
                crew: 76,
                cargo: 788200,
                fuel: 696521,
                ammo: 1107290,
                mining: 2798650,
                speed: 7700,
                price: null,
                type: "Fighter"
            },
            
            // Class 9 Ships (Titans)
            "PHI": {
                name: "Rainbow Phi",
                class: 9,
                points: 81,
                crew: 255,
                cargo: 15149652,
                fuel: 9771668,
                ammo: 8987082,
                mining: 26754910,
                speed: 7300,
                price: null,
                type: "Fighter"
            },
            "SUPER": {
                name: "Fimbul ECOS Superphoenix",
                class: 9,
                points: 81,
                crew: 347,
                cargo: 9928586,
                fuel: 9771668,
                ammo: 14051231,
                mining: 27116460,
                speed: 4100,
                price: null,
                type: "Bomber"
            },
            "T1TAN": {
                name: "Pearce T1",
                class: 9,
                points: 81,
                crew: 212,
                cargo: 12296610,
                fuel: 8345147,
                ammo: 13266644,
                mining: 26754910,
                speed: 6400,
                price: null,
                type: "Fighter"
            },
            "STAND": {
                name: "Busan The Last Stand mk. VIII",
                class: 9,
                points: 81,
                crew: 412,
                cargo: 13149072,
                fuel: 9771668,
                ammo: 11174510,
                mining: 27478010,
                speed: 7000,
                price: null,
                type: "Fighter"
            }
        };

        // Resource and crafting data
        const SAGE_RESOURCES = {
            // Raw Materials
            "HYG": { name: "Hydrogen", hardness: 100, priceRange: [0.00026606, 0.00027777] },
            "CARBON": { name: "Carbon", hardness: 100, priceRange: [0.00045152, 0.00056986] },
            "BIOMASS": { name: "Biomass", hardness: 100, priceRange: [0.0004751, 0.00075] },
            "NITRO": { name: "Nitrogen", hardness: 100, priceRange: [0.00052826, 0.000879] },
            "FEORE": { name: "Iron Ore", hardness: 200, priceRange: [0.00069102, 0.0008] },
            "CUORE": { name: "Copper Ore", hardness: 200, priceRange: [0.00071, 0.000799] },
            "SAND": { name: "Silica", hardness: 200, priceRange: [0.00090802, 0.00125] },
            "LUMAN": { name: "Lumanite", hardness: 250, priceRange: [0.00100888, 0.00155555] },
            "TIORE": { name: "Titanium Ore", hardness: 500, priceRange: [0.00120022, 0.001849] },
            "DIAMOND": { name: "Diamond", hardness: 400, priceRange: [0.0019, 0.002999] },
            "ROCH": { name: "Rochinol", hardness: 400, priceRange: [0.0019, 0.00242261] },
            "ARCO": { name: "Arco", hardness: 400, priceRange: [0.0019, 0.00238] },
            
            // Crafted Materials
            "IRON": { name: "Iron", duration: 1, points: 2, fee: 0.0000363, inputs: ["FEORE"] },
            "COPPER": { name: "Copper", duration: 1, points: 2, fee: 0.00004135, inputs: ["CUORE"] },
            "TTNM": { name: "Titanium", duration: 1, points: 3, fee: 0.0000871, inputs: ["TIORE"] },
            "STEEL": { name: "Steel", duration: 4, points: 3, fee: 0.00009965, inputs: ["IRON", "CARBON"] },
            "POLYMER": { name: "Polymer", duration: 4, points: 3, fee: 0.00001655, inputs: ["BIOMASS", "CARBON"] },
            "MAGNET": { name: "Magnet", duration: 4, points: 4, fee: 0.00004105, inputs: ["IRON"] },
            "HCRB": { name: "Hydrocarbon", duration: 2, points: 4, fee: 0.00004825, inputs: ["CARBON", "HYG"] },
            "GRAPH": { name: "Graphene", duration: 2, points: 5, fee: 0.00007105, inputs: ["CARBON"] },
            "AGEL": { name: "Aerogel", duration: 2, points: 7, fee: 0.0002932, inputs: ["SAND"] },
            "ENRGSUB": { name: "Energy Substrate", duration: 6, points: 10, fee: 0.0001403, inputs: ["HYG", "CARBON"] },
            "CRYSLAT": { name: "Crystal Lattice", duration: 4, points: 13, fee: 0.00020185, inputs: ["SAND", "CARBON"] },
            "STRANGE": { name: "Strange Emitter", duration: 6, points: 16, fee: 0.00020755, inputs: ["DIAMOND", "ENRGSUB"] },
            "SPRCOND": { name: "Super Conductor", duration: 8, points: 20, fee: 0.00051015, inputs: ["COPPER", "GRAPH"] },
            "FRMWRK": { name: "Framework", duration: 12, points: 68, fee: 0.00016795, inputs: ["STEEL", "POLYMER"] },
            "ELECTRO": { name: "Electronics", duration: 14, points: 92, fee: 0.0001326, inputs: ["COPPER", "SAND"] },
            "PWRSRC": { name: "Power Source", duration: 15, points: 98, fee: 0.0001246, inputs: ["ENRGSUB", "MAGNET"] },
            "FSTAB": { name: "Field Stabilizer", duration: 24, points: 222, fee: 0.00085765, inputs: ["CRYSLAT", "STRANGE"] },
            "PRTACL": { name: "Particle Accelerator", duration: 96, points: 498, fee: 0.00075215, inputs: ["SPRCOND", "FSTAB"] },
            
            // Consumables
            "FUEL": { name: "Fuel", duration: 1, points: 3, fee: 0.0000513, inputs: ["HCRB", "HYG"] },
            "AMMO": { name: "Ammunition", duration: 1, points: 3, fee: 0.0000622, inputs: ["IRON", "CARBON"] },
            "FOOD": { name: "Food", duration: 1, points: 6, fee: 0.00005425, inputs: ["BIOMASS"] },
            "TOOL": { name: "Toolkit", duration: 2, points: 14, fee: 0.0000702, inputs: ["STEEL", "ELECTRO"] }
        };

        // Global optimizer state
        let selectedOptimizerShips = {};
        let selectedFleetObjective = 'mining';
        let totalOptimizerFleetPoints = 0;

        // Global state
        let currentFaction = 'mud';
        let galaxyData = null;
        let isLoading = false;
        let playerFleet = null;
        let selectedObjective = 'balanced'; // 'mining', 'scanning', 'crafting', 'balanced'

        // Demo wallet address (known Star Atlas player with 23 fleets)
        const DEMO_WALLET = '6BLffwKceYy2fYczkRwZ6gXZ7rJ9HfVQC1MNAZWjTQ7L';

        // Ship rarity colors
        const rarityColors = {
            'common': '#888888',
            'uncommon': '#00d4aa',
            'rare': '#3b82f6',
            'epic': '#8b5cf6',
            'legendary': '#f59e0b',
            'anomaly': '#ef4444'
        };

        // Manufacturer to faction mapping
        const factionMapping = {
            'mud': ['Busan', 'Pearce', 'Armstrong'],
            'oni': ['Calico', 'VZUS', 'Opal', 'Fimbul ECOS'],
            'ustur': ['Ogrika', 'Fimbul', 'Fimbul BYOS', 'Tufa', 'Rainbow']
        };

        // Faction metadata with real stats-based info
        const factionData = {
            mud: {
                name: 'MUD',
                fullName: 'Manus Ultimus Dei',
                icon: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 7V4a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v3"/><path d="M16 21V8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v13"/><path d="M6 11h8"/><path d="M6 15h8"/></svg>',
                description: 'The industrial powerhouse of Star Atlas, specializing in heavy manufacturing and resource extraction operations.',
                advantages: ['High-capacity mining ships', 'Industrial supremacy', 'Balanced fleet composition', 'Excellent fighter coverage'],
                resources: ['Iron Ore', 'Titanium', 'Carbon Fiber', 'Hydrogen Fuel'],
                sectors: ['Galia Sector', 'MRZ-84', 'Industrial Belt-7', 'Mining Colony Alpha'],
                strategy: ['Deploy IMP series miners', 'Focus on resource extraction', 'Control supply chains', 'Use fighter escorts']
            },
            oni: {
                name: 'ONI',
                fullName: 'Oligarchical Nexus',
                icon: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
                description: 'Masters of advanced technology and precision engineering, excelling in specialized operations and data collection.',
                advantages: ['Advanced scanning capabilities', 'Specialized ships', 'Technology leadership', 'Data supremacy'],
                resources: ['Rare Crystals', 'Quantum Processors', 'Biometrics', 'Energy Cells'],
                sectors: ['Central Space', 'Tech Hub Delta', 'ONI Research Zone', 'Cipher Nebula'],
                strategy: ['Use data runners for intel', 'Leverage tech advantages', 'Control information flows', 'Specialized operations']
            },
            ustur: {
                name: 'USTUR',
                fullName: 'United Secessionist Territories',
                icon: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="6" height="6"/><rect x="14" y="4" width="6" height="6"/><rect x="4" y="14" width="6" height="6"/><rect x="14" y="14" width="6" height="6"/><line x1="9" y1="9" x2="15" y2="15"/><line x1="15" y1="9" x2="9" y2="15"/></svg>',
                description: 'The adaptive rebellion utilizing modular systems and guerrilla tactics for maximum operational flexibility.',
                advantages: ['BYOS modular systems', 'Guerrilla tactics', 'Efficiency optimization', 'Adaptive strategies'],
                resources: ['Synthetic Materials', 'AI Cores', 'Automation Parts', 'Fuel Cells'],
                sectors: ['Outer Rim', 'USTUR Territory', 'Frontier Zone-12', 'Liberation Sector'],
                strategy: ['Maximize BYOS flexibility', 'Hit-and-run operations', 'Optimize efficiency', 'Adaptive composition']
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            setupScrollReveal();
            await loadGalaxyData();
            updateAnalysis();
            setupWalletInput();
            setupWalletListeners();
        });

        // Setup wallet input event listeners
        function setupWalletInput() {
            const walletInput = document.getElementById('walletInput');
            const analyzeBtn = document.getElementById('analyzeFleetBtn');
            
            walletInput.addEventListener('input', (e) => {
                clearWalletError();
                const isValid = validateWalletAddress(e.target.value);
                analyzeBtn.disabled = !isValid;
            });
            
            walletInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !analyzeBtn.disabled) {
                    analyzeWallet();
                }
            });
        }

        // ============================================================
        // Secure Wallet Connect (Read-Only)
        // ============================================================
        // Security principles:
        // 1. We ONLY request the public key — never sign transactions
        // 2. No private keys ever touch our code
        // 3. Connection is read-only for address extraction
        // 4. Works with Phantom, Solflare, Backpack, and other Solana wallets
        // 5. No external wallet adapter libraries — minimal attack surface
        
        let connectedWallet = null;
        
        async function connectWallet() {
            const btn = document.getElementById('walletConnectBtn');
            const label = document.getElementById('walletConnectLabel');
            
            // If already connected, disconnect
            if (connectedWallet) {
                disconnectWallet();
                return;
            }
            
            // Detect available wallet providers
            const provider = detectWalletProvider();
            if (!provider) {
                showWalletError('No Solana wallet detected. Please install Phantom, Solflare, or Backpack.');
                return;
            }
            
            btn.disabled = true;
            label.textContent = 'Connecting...';
            
            try {
                // Request ONLY the public key — no signing permissions
                const response = await provider.connect({ onlyIfTrusted: false });
                const publicKey = response.publicKey.toString();
                
                // Validate the returned address
                if (!validateWalletAddress(publicKey)) {
                    throw new Error('Invalid public key received from wallet');
                }
                
                connectedWallet = {
                    publicKey,
                    provider,
                    providerName: getProviderName(provider)
                };
                
                // Update UI
                label.textContent = `${publicKey.slice(0, 4)}...${publicKey.slice(-4)}`;
                btn.classList.add('connected');
                
                // Fill the input and auto-analyze
                document.getElementById('walletInput').value = publicKey;
                clearWalletError();
                
                console.log(`[Wallet] Connected via ${connectedWallet.providerName}: ${publicKey}`);
                
                // Auto-analyze the connected wallet
                await analyzeWallet();
                
            } catch (error) {
                console.error('[Wallet] Connection failed:', error);
                if (error.code === 4001 || error.message?.includes('rejected')) {
                    // User rejected — that's fine
                    showWalletError('Connection cancelled by user.');
                } else {
                    showWalletError('Failed to connect wallet. Please try again.');
                }
                connectedWallet = null;
                label.textContent = 'Connect Wallet';
            } finally {
                btn.disabled = false;
            }
        }
        
        function disconnectWallet() {
            if (connectedWallet?.provider?.disconnect) {
                try { connectedWallet.provider.disconnect(); } catch(e) { /* silent */ }
            }
            connectedWallet = null;
            
            const btn = document.getElementById('walletConnectBtn');
            const label = document.getElementById('walletConnectLabel');
            label.textContent = 'Connect Wallet';
            btn.classList.remove('connected');
            
            document.getElementById('walletInput').value = '';
            console.log('[Wallet] Disconnected');
        }
        
        function detectWalletProvider() {
            // Priority order: Phantom > Solflare > Backpack > generic
            // Each uses the window.solana or provider-specific namespace
            if (window.phantom?.solana?.isPhantom) return window.phantom.solana;
            if (window.solflare?.isSolflare) return window.solflare;
            if (window.backpack?.isBackpack) return window.backpack;
            if (window.solana?.isPhantom) return window.solana;
            if (window.solana) return window.solana;
            return null;
        }
        
        function getProviderName(provider) {
            if (provider.isPhantom) return 'Phantom';
            if (provider.isSolflare) return 'Solflare';
            if (provider.isBackpack) return 'Backpack';
            return 'Solana Wallet';
        }
        
        // Listen for wallet disconnect events
        function setupWalletListeners() {
            const provider = detectWalletProvider();
            if (provider) {
                provider.on?.('disconnect', () => {
                    if (connectedWallet) {
                        console.log('[Wallet] Wallet disconnected externally');
                        disconnectWallet();
                    }
                });
                provider.on?.('accountChanged', (publicKey) => {
                    if (publicKey && connectedWallet) {
                        console.log('[Wallet] Account changed to:', publicKey.toString());
                        connectedWallet.publicKey = publicKey.toString();
                        document.getElementById('walletInput').value = publicKey.toString();
                        document.getElementById('walletConnectLabel').textContent = 
                            `${publicKey.toString().slice(0, 4)}...${publicKey.toString().slice(-4)}`;
                        analyzeWallet();
                    } else {
                        disconnectWallet();
                    }
                });
            }
        }

        // Validate Solana wallet address format
        function validateWalletAddress(address) {
            if (!address) return false;
            
            // Basic validation: base58, 32-44 characters
            const base58Regex = /^[1-9A-HJ-NP-Za-km-z]{32,44}$/;
            return base58Regex.test(address.trim());
        }

        // Show wallet validation error
        function showWalletError(message) {
            const input = document.getElementById('walletInput');
            const error = document.getElementById('walletError');
            
            input.classList.add('error');
            error.textContent = message;
            error.classList.add('visible');
        }

        // Clear wallet error state
        function clearWalletError() {
            const input = document.getElementById('walletInput');
            const error = document.getElementById('walletError');
            
            input.classList.remove('error');
            error.classList.remove('visible');
        }

        // Main wallet analysis function
        // ============================================================
        // SAGE Program Constants for Fleet Lookup
        // ============================================================
        const SAGE_PROGRAM_ID = 'SAGE2HAwep459SNq61LHvjxPk4pLPEJLoMETef7f7EE';
        const PLAYER_PROFILE_PROGRAM_ID = 'pprofELXjL5Kck7Jn5hCpwAL82DpTkSYBENzahVtbc9';
        const SAGE_GAME_ID = 'GAMEzqJehF8yAnKiTARUuhZMvLvkZVAsCVri5vSfemLr';
        const IRONFORGE_RPC = 'https://rpc.ironforge.network/mainnet?apiKey=01JKXP5WV0M8A3F2S5EYSK6WXZ';

        // Precomputed Anchor account discriminators (first 8 bytes of sha256("account:<Name>"))
        // Profile: sha256("account:Profile") -> b865a5bc5f3f7fbc (wallet key at offset 30)
        // Fleet:   sha256("account:Fleet")   -> 6dcffb306a0288a3
        const DISCRIMINATOR_PROFILE = [0xb8, 0x65, 0xa5, 0xbc, 0x5f, 0x3f, 0x7f, 0xbc];
        const DISCRIMINATOR_FLEET = [0x6d, 0xcf, 0xfb, 0x30, 0x6a, 0x02, 0x88, 0xa3];

        // Base58 encoding for discriminators (for RPC memcmp filters)
        function bytesToBase58(bytes) {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let num = BigInt(0);
            for (const b of bytes) num = num * 256n + BigInt(b);
            let encoded = '';
            while (num > 0n) {
                encoded = ALPHABET[Number(num % 58n)] + encoded;
                num = num / 58n;
            }
            for (const b of bytes) {
                if (b === 0) encoded = '1' + encoded;
                else break;
            }
            return encoded || '1';
        }

        const DISC_PROFILE_B58 = bytesToBase58(DISCRIMINATOR_PROFILE);
        const DISC_FLEET_B58 = bytesToBase58(DISCRIMINATOR_FLEET);

        // Helper: make RPC call to Ironforge
        async function sageRpc(method, params) {
            const response = await fetch(IRONFORGE_RPC, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ jsonrpc: '2.0', id: 1, method, params })
            });
            const data = await response.json();
            if (data.error) throw new Error(`RPC ${method}: ${data.error.message}`);
            return data.result;
        }

        // Helper: decode base64 account data to Uint8Array
        function decodeAccountData(base64Data) {
            const binary = atob(base64Data);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
            return bytes;
        }

        // Helper: read a 32-byte public key from buffer at offset, return base58
        function readPubkey(buf, offset) {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            const bytes = buf.slice(offset, offset + 32);
            let num = BigInt(0);
            for (const b of bytes) num = num * 256n + BigInt(b);
            let encoded = '';
            while (num > 0n) {
                encoded = ALPHABET[Number(num % 58n)] + encoded;
                num = num / 58n;
            }
            for (const b of bytes) {
                if (b === 0) encoded = '1' + encoded;
                else break;
            }
            return encoded || '1';
        }

        // Helper: read u32 little-endian
        function readU32LE(buf, offset) {
            return buf[offset] | (buf[offset+1] << 8) | (buf[offset+2] << 16) | (buf[offset+3] << 24);
        }

        // Helper: read u64 little-endian (as Number, safe for ship counts)
        function readU64LE(buf, offset) {
            const lo = buf[offset] | (buf[offset+1] << 8) | (buf[offset+2] << 16) | (buf[offset+3] << 24);
            const hi = buf[offset+4] | (buf[offset+5] << 8) | (buf[offset+6] << 16) | (buf[offset+7] << 24);
            return (hi >>> 0) * 0x100000000 + (lo >>> 0);
        }

        // ============================================================
        // Main Wallet Analysis - Real SAGE Fleet Lookup
        // ============================================================
        async function analyzeWallet() {
            const walletInput = document.getElementById('walletInput');
            const address = walletInput.value.trim();
            
            if (!validateWalletAddress(address)) {
                showWalletError('Invalid wallet address format. Please enter a valid Solana wallet address.');
                return;
            }
            
            clearWalletError();
            
            // Show loading state
            const analyzeBtn = document.getElementById('analyzeFleetBtn');
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<div class="loading-spinner" style="width:16px;height:16px;margin:0;border-width:1px;"></div> Scanning SAGE fleets...';
            analyzeBtn.disabled = true;
            
            try {
                // Try real SAGE fleet lookup first
                const fleetResult = await fetchSageFleets(address);
                
                if (fleetResult && fleetResult.ships.length > 0) {
                    // Enhance with SAGE stats
                    const enhancedFleet = enhanceFleetWithStats(fleetResult.ships);
                    
                    playerFleet = {
                        walletAddress: address,
                        ships: enhancedFleet,
                        fleetDetails: fleetResult.fleetDetails,
                        fleets: fleetResult.fleets,
                        profileAddress: fleetResult.profileAddress,
                        source: 'sage'
                    };
                    showPlayerFleet();
                    showPersonalizedRecommendations();
                } else {
                    // Fallback: try token account scanning for unstaked ships
                    console.log('No SAGE fleets found, falling back to token scan...');
                    analyzeBtn.innerHTML = '<div class="loading-spinner" style="width:16px;height:16px;margin:0;border-width:1px;"></div> Checking wallet tokens...';
                    
                    const tokenAccounts = await fetchPlayerTokens(address);
                    if (!tokenAccounts || tokenAccounts.length === 0) {
                        showNoFleetFound();
                        return;
                    }
                    
                    const starAtlasAssets = await crossReferenceAssets(tokenAccounts);
                    if (starAtlasAssets.length === 0) {
                        showNoFleetFound();
                    } else {
                        const enhancedFleet = enhanceFleetWithStats(starAtlasAssets);
                        playerFleet = {
                            walletAddress: address,
                            ships: enhancedFleet,
                            source: 'token'
                        };
                        showPlayerFleet();
                        showPersonalizedRecommendations();
                    }
                }
                
            } catch (error) {
                console.error('Error analyzing wallet:', error);
                showWalletError('Failed to analyze wallet. Please try again or use the demo.');
            } finally {
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
            }
        }

        // ============================================================
        // SAGE Fleet Lookup via Ironforge RPC
        // ============================================================
        async function fetchSageFleets(walletAddress) {
            try {
                // Load Galaxy data first if needed (for mint → name mapping)
                if (!galaxyData) {
                    await loadGalaxyData();
                }
                const mintToShipInfo = new Map();
                if (galaxyData) {
                    galaxyData.forEach(item => {
                        if (item.attributes?.itemType === 'ship' && item.mint) {
                            mintToShipInfo.set(item.mint, item);
                        }
                    });
                }

                // Step 1: Resolve the pprofELX profile key
                // Strategy: The input might be:
                //   a) A SagePlayerProfile address (owned by SAGE2 program, 74 bytes)
                //   b) A regular wallet address (needs pprofELX lookup)
                // We try (a) first since it's a single getAccountInfo call, then fall back to (b)
                
                console.log('[SAGE] Resolving profile for', walletAddress);
                let profileAddress = null;

                // Strategy A: Check if input is a SagePlayerProfile account (owned by SAGE2)
                try {
                    const acctInfo = await sageRpc('getAccountInfo', [
                        walletAddress, { encoding: 'base64' }
                    ]);
                    if (acctInfo && acctInfo.value && acctInfo.value.owner === SAGE_PROGRAM_ID) {
                        const buf = decodeAccountData(acctInfo.value.data[0]);
                        // SagePlayerProfile layout: disc(8) + version(1) + pprofKey(32) + gameId(32) + bump(1) = 74
                        if (buf.length === 74) {
                            profileAddress = readPubkey(buf, 9); // pprofELX key at bytes 9-41
                            console.log('[SAGE] Input is SagePlayerProfile → pprofELX key:', profileAddress);
                        }
                    }
                } catch (e) {
                    console.log('[SAGE] Strategy A (SagePlayerProfile check) failed:', e.message);
                }

                // Strategy B: Search pprofELX program for a Profile containing this wallet key
                // A wallet can have multiple pprofELX profiles — we need the one with a SagePlayerProfile
                if (!profileAddress) {
                    console.log('[SAGE] Trying pprofELX profile lookup...');
                    const profiles = await sageRpc('getProgramAccounts', [
                        PLAYER_PROFILE_PROGRAM_ID,
                        {
                            encoding: 'base64',
                            dataSlice: { offset: 0, length: 0 },
                            filters: [
                                { memcmp: { offset: 0, bytes: DISC_PROFILE_B58 } },
                                { memcmp: { offset: 30, bytes: walletAddress } },
                            ],
                        }
                    ]);
                    if (profiles && profiles.length > 0) {
                        console.log(`[SAGE] Found ${profiles.length} pprofELX profile(s), checking for SagePlayerProfile...`);
                        const DISC_SPP_B58 = bytesToBase58([0x0a, 0x37, 0x4b, 0xea, 0x7e, 0x0e, 0x2f, 0x92]);
                        // Check each profile for a corresponding SagePlayerProfile
                        for (const p of profiles) {
                            const sppCheck = await sageRpc('getProgramAccounts', [
                                SAGE_PROGRAM_ID,
                                {
                                    encoding: 'base64',
                                    dataSlice: { offset: 0, length: 0 },
                                    filters: [
                                        { memcmp: { offset: 0, bytes: DISC_SPP_B58 } },
                                        { memcmp: { offset: 9, bytes: p.pubkey } },
                                    ],
                                }
                            ]);
                            if (sppCheck && sppCheck.length > 0) {
                                profileAddress = p.pubkey;
                                console.log('[SAGE] Found pprofELX profile with SAGE registration:', profileAddress);
                                break;
                            }
                        }
                        // Fallback: use first profile if none had a SagePlayerProfile
                        if (!profileAddress) {
                            profileAddress = profiles[0].pubkey;
                            console.log('[SAGE] No SAGE-registered profile found, using first:', profileAddress);
                        }
                    }
                }

                // Strategy C: Check if input IS a pprofELX profile key directly
                // (search for SagePlayerProfile accounts that reference it)
                if (!profileAddress) {
                    console.log('[SAGE] Trying input as pprofELX key directly...');
                    const DISC_SPP_B58 = bytesToBase58([0x0a, 0x37, 0x4b, 0xea, 0x7e, 0x0e, 0x2f, 0x92]);
                    const sppAccounts = await sageRpc('getProgramAccounts', [
                        SAGE_PROGRAM_ID,
                        {
                            encoding: 'base64',
                            dataSlice: { offset: 0, length: 0 },
                            filters: [
                                { memcmp: { offset: 0, bytes: DISC_SPP_B58 } },
                                { memcmp: { offset: 9, bytes: walletAddress } },
                            ],
                        }
                    ]);
                    if (sppAccounts && sppAccounts.length > 0) {
                        profileAddress = walletAddress; // The input IS the pprofELX key
                        console.log('[SAGE] Input is pprofELX key directly');
                    }
                }

                if (!profileAddress) {
                    console.log('[SAGE] No profile found for input address');
                    return null;
                }

                // Step 2: Find all Fleet accounts for this pprofELX profile key
                const fleetAccounts = await sageRpc('getProgramAccounts', [
                    SAGE_PROGRAM_ID,
                    {
                        encoding: 'base64',
                        filters: [
                            { memcmp: { offset: 0, bytes: DISC_FLEET_B58 } },
                            { memcmp: { offset: 41, bytes: profileAddress } },
                        ],
                    }
                ]);

                if (!fleetAccounts || fleetAccounts.length === 0) {
                    console.log('[SAGE] No fleets found for profile');
                    return null;
                }

                console.log(`[SAGE] Found ${fleetAccounts.length} fleet(s)`);

                // Parse fleet data and collect FleetShips keys
                const fleetDetails = [];
                const fleetShipsKeys = [];
                for (const f of fleetAccounts) {
                    const buf = decodeAccountData(f.account.data[0]);
                    const fleetShipsKey = readPubkey(buf, 73);
                    const faction = buf[169];
                    const labelBytes = buf.slice(170, 202);
                    const label = String.fromCharCode(...labelBytes).replace(/\0/g, '');
                    
                    fleetDetails.push({
                        address: f.pubkey,
                        fleetShipsKey,
                        faction,
                        label: label || 'Unnamed Fleet',
                    });
                    fleetShipsKeys.push(fleetShipsKey);
                }

                // Step 3: Batch fetch all FleetShips accounts
                const fsAccounts = await sageRpc('getMultipleAccounts', [
                    fleetShipsKeys, { encoding: 'base64' }
                ]);

                // Collect all unique ship account keys
                const allShipKeys = new Set();
                const fleetShipEntries = [];
                
                for (let i = 0; i < fleetDetails.length; i++) {
                    const fsAccount = fsAccounts.value[i];
                    if (!fsAccount) { fleetShipEntries.push([]); continue; }
                    
                    const fsBuf = decodeAccountData(fsAccount.data[0]);
                    const count = readU32LE(fsBuf, 41);
                    const ships = [];
                    
                    for (let j = 0; j < count; j++) {
                        const off = 46 + (j * 48);
                        if (off + 40 > fsBuf.length) break;
                        const shipAcctKey = readPubkey(fsBuf, off);
                        const amount = readU64LE(fsBuf, off + 32);
                        ships.push({ shipAcctKey, amount });
                        allShipKeys.add(shipAcctKey);
                    }
                    fleetShipEntries.push(ships);
                }

                // Step 4: Batch fetch all Ship accounts to resolve mints
                const shipKeysArr = [...allShipKeys];
                let shipMintMap = {};
                
                // Batch in groups of 100 (RPC limit)
                for (let i = 0; i < shipKeysArr.length; i += 100) {
                    const batch = shipKeysArr.slice(i, i + 100);
                    const shipAccounts = await sageRpc('getMultipleAccounts', [
                        batch, { encoding: 'base64' }
                    ]);
                    for (let j = 0; j < batch.length; j++) {
                        if (!shipAccounts.value[j]) continue;
                        const sBuf = decodeAccountData(shipAccounts.value[j].data[0]);
                        // Ship account: disc(8) + version(1) + gameId(32) + mint(32)
                        shipMintMap[batch[j]] = readPubkey(sBuf, 41);
                    }
                }

                // Step 5: Build aggregated ship list for the analyzer
                // Aggregate ships across all fleets by mint
                const shipAggregation = new Map(); // mint -> { info, totalOwned, fleets[] }
                
                for (let i = 0; i < fleetDetails.length; i++) {
                    for (const entry of fleetShipEntries[i]) {
                        const mint = shipMintMap[entry.shipAcctKey];
                        if (!mint) continue;
                        
                        const galaxyInfo = mintToShipInfo.get(mint);
                        if (!galaxyInfo) continue;
                        
                        const key = mint;
                        if (!shipAggregation.has(key)) {
                            shipAggregation.set(key, {
                                galaxyInfo,
                                mint,
                                totalOwned: 0,
                                fleets: []
                            });
                        }
                        const agg = shipAggregation.get(key);
                        agg.totalOwned += entry.amount;
                        agg.fleets.push({
                            label: fleetDetails[i].label,
                            amount: entry.amount
                        });
                    }
                }

                // Convert to format expected by the rest of the analyzer
                const ships = [];
                for (const [mint, agg] of shipAggregation) {
                    ships.push({
                        ...agg.galaxyInfo,
                        mint: agg.mint,
                        owned: agg.totalOwned,
                        symbol: agg.galaxyInfo.symbol,
                        name: agg.galaxyInfo.name,
                        markets: agg.galaxyInfo.markets || [{ ui: 0 }],
                        fleetAssignments: agg.fleets,
                        source: 'sage'
                    });
                }

                console.log(`[SAGE] Resolved ${ships.length} unique ship types, ${ships.reduce((s, sh) => s + sh.owned, 0)} total ships`);

                // Build per-fleet ship arrays with resolved stats
                const fleetsWithShips = fleetDetails.map((fd, i) => ({
                    ...fd,
                    ships: fleetShipEntries[i].map(entry => {
                        const mint = shipMintMap[entry.shipAcctKey];
                        const galaxyInfo = mint ? mintToShipInfo.get(mint) : null;
                        const stats = galaxyInfo ? SAGE_SHIP_STATS.find(s =>
                            s.symbol === galaxyInfo.symbol ||
                            s.shipName.toLowerCase() === (galaxyInfo.name || '').toLowerCase()
                        ) : null;
                        return { mint, amount: entry.amount, galaxyInfo, stats, name: galaxyInfo?.name || 'Unknown', symbol: galaxyInfo?.symbol || '?' };
                    }).filter(s => s.mint)
                }));

                return {
                    profileAddress,
                    fleetDetails,
                    fleets: fleetsWithShips,
                    ships,
                    totalFleets: fleetDetails.length,
                    totalShips: ships.reduce((s, sh) => s + sh.owned, 0)
                };

            } catch (error) {
                console.error('[SAGE] Fleet lookup failed:', error);
                return null; // Will fall back to token scanning
            }
        }

        // Enhance fleet with real SAGE stats
        function enhanceFleetWithStats(assets) {
            return assets.map(asset => {
                // Find matching ship stats by name/symbol
                const stats = SAGE_SHIP_STATS.find(ship => 
                    ship.symbol === asset.symbol || 
                    ship.shipName.toLowerCase() === asset.name.toLowerCase() ||
                    asset.name.toLowerCase().includes(ship.shipName.toLowerCase().split(' ')[0])
                );

                if (stats) {
                    return {
                        ...asset,
                        stats: stats,
                        realStats: true
                    };
                }

                return asset;
            });
        }

        // Fetch player's token accounts from Solana RPC
        async function fetchPlayerTokens(walletAddress) {
            try {
                // Query Solana RPC for token accounts
                const response = await fetch(IRONFORGE_RPC, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getTokenAccountsByOwner',
                        params: [
                            walletAddress,
                            { programId: 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA' },
                            { encoding: 'jsonParsed' }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`RPC request failed: ${response.status}`);
                }

                const rpcData = await response.json();
                
                if (rpcData.error) {
                    throw new Error(`RPC error: ${rpcData.error.message}`);
                }

                // Get token accounts with balances
                const tokenAccounts = rpcData.result?.value || [];
                
                // Filter for accounts with balance > 0 and get mint addresses
                const ownedTokens = tokenAccounts
                    .filter(account => {
                        const amount = account.account.data.parsed.info.tokenAmount.uiAmount;
                        return amount && amount > 0;
                    })
                    .map(account => ({
                        mint: account.account.data.parsed.info.mint,
                        amount: account.account.data.parsed.info.tokenAmount.uiAmount
                    }));

                return ownedTokens;
                
            } catch (error) {
                console.error('Error fetching token accounts:', error);
                // Fallback to demo data on error
                const demoTokens = [
                    { symbol: 'IMP3', name: 'Armstrong IMP', amount: 1 },
                    { symbol: 'CALG', name: 'Calico Guardian', amount: 2 },
                    { symbol: 'PF4', name: 'Pearce F4', amount: 1 }
                ];
                return demoTokens;
            }
        }

        // Cross-reference token accounts with Star Atlas NFTs
        async function crossReferenceAssets(tokenAccounts) {
            try {
                // Fetch Galaxy API data if we don't have it already
                if (!galaxyData) {
                    await loadGalaxyData();
                }

                // Create a map of mint addresses to Galaxy data for ships
                const shipMintMap = new Map();
                if (galaxyData) {
                    galaxyData.forEach(item => {
                        if (item.attributes?.itemType === 'ship' && item.mint) {
                            shipMintMap.set(item.mint, item);
                        }
                    });
                }

                // Cross-reference player's tokens with Star Atlas ships
                const starAtlasShips = [];
                
                tokenAccounts.forEach(token => {
                    if (token.mint) {
                        // Check if this mint is a Star Atlas ship
                        const shipData = shipMintMap.get(token.mint);
                        if (shipData) {
                            starAtlasShips.push({
                                ...shipData,
                                owned: token.amount || 1,
                                mint: token.mint
                            });
                        }
                    } else if (token.symbol) {
                        // Fallback for demo data format
                        starAtlasShips.push({
                            ...token,
                            owned: token.amount || 1,
                            symbol: token.symbol,
                            name: token.name,
                            markets: [{ ui: Math.random() * 5000 + 500 }]
                        });
                    }
                });

                return starAtlasShips;
                
            } catch (error) {
                console.error('Error cross-referencing assets:', error);
                // Fallback: treat input as ship data for demo
                return tokenAccounts.map(token => ({
                    ...token,
                    owned: token.amount || 1,
                    markets: [{ ui: Math.random() * 5000 + 500 }]
                }));
            }
        }

        // Show player's fleet with real stats
        function showPlayerFleet() {
            if (!playerFleet) return;
            
            const section = document.getElementById('yourFleetSection');
            const addressDisplay = document.getElementById('fleetWalletAddress');
            const statsContainer = document.getElementById('fleetStats');
            const scoreContainer = document.getElementById('compositionScore');
            const breakdownContainer = document.getElementById('fleetBreakdown');
            const rosterContainer = document.getElementById('shipRoster');
            
            // Display wallet address with data source badge
            const address = playerFleet.walletAddress;
            const sourceBadge = playerFleet.source === 'sage' 
                ? '<span style="background:var(--accent-dim);color:var(--accent);padding:2px 8px;border-radius:4px;font-size:0.7rem;font-family:var(--font-display);font-weight:500;margin-left:8px;letter-spacing:0.03em;">⚡ SAGE ON-CHAIN</span>'
                : '<span style="background:rgba(255,255,255,0.05);color:var(--text-secondary);padding:2px 8px;border-radius:4px;font-size:0.7rem;font-family:var(--font-display);font-weight:500;margin-left:8px;letter-spacing:0.03em;">📦 WALLET TOKENS</span>';
            addressDisplay.innerHTML = `${address.slice(0, 6)}...${address.slice(-4)}${sourceBadge}`;
            
            // Calculate real fleet statistics
            const fleetAnalysis = calculateRealFleetStats(playerFleet.ships);
            
            // Show fleet count if from SAGE
            const fleetCountHtml = playerFleet.fleetDetails 
                ? `<div class="fleet-stat">
                    <div class="fleet-stat-value">${playerFleet.fleetDetails.length}</div>
                    <div class="fleet-stat-label">Active Fleets</div>
                   </div>` 
                : '';

            // Calculate total ship count and fleet points
            const totalShipCount = playerFleet.ships.reduce((sum, s) => sum + (s.owned || 1), 0);
            const classPoints = { '1': 1, '2': 4, '3': 9, '4': 16, '5': 25, '6': 36, '7': 49, '9': 81 };
            const totalFleetPoints = playerFleet.ships.reduce((sum, ship) => 
                sum + (classPoints[ship.stats?.class] || 1) * ship.owned, 0
            );
            
            // Fleet points utilization display
            const pointsPerFleet = playerFleet.fleetDetails ? Math.ceil(totalFleetPoints / playerFleet.fleetDetails.length) : totalFleetPoints;
            const pointsColor = totalFleetPoints <= 145 ? 'var(--accent)' : '#f59e0b';
            
            // Update stats display
            statsContainer.innerHTML = `
                ${fleetCountHtml}
                <div class="fleet-stat">
                    <div class="fleet-stat-value">${totalShipCount}</div>
                    <div class="fleet-stat-label">Total Ships</div>
                </div>
                <div class="fleet-stat">
                    <div class="fleet-stat-value" style="color:${pointsColor};">${totalFleetPoints}</div>
                    <div class="fleet-stat-label">Fleet Points ${playerFleet.fleetDetails ? `(~${pointsPerFleet}/fleet)` : ''}</div>
                </div>
                <div class="fleet-stat">
                    <div class="fleet-stat-value">${Math.round(fleetAnalysis.avgMiningRate).toLocaleString()}</div>
                    <div class="fleet-stat-label">Avg Mining Rate</div>
                </div>
                <div class="fleet-stat">
                    <div class="fleet-stat-value">${Math.round(fleetAnalysis.avgCargoCapacity).toLocaleString()}</div>
                    <div class="fleet-stat-label">Avg Cargo</div>
                </div>
            `;
            
            // Show Fleet Composition Score
            const compositionScore = calculateFleetCompositionScore(fleetAnalysis, playerFleet.ships);
            scoreContainer.innerHTML = `
                <div class="score-title">Portfolio Overview — Fleet Composition Score</div>
                <div class="score-value">${compositionScore}/100</div>
                <div class="score-desc">Aggregate score across ALL fleets — mining capacity, cargo efficiency, and fleet diversification</div>
            `;

            // Show objective selector if we have fleet data
            const objSelector = document.getElementById('objectiveSelector');
            if (playerFleet.fleetDetails && playerFleet.fleetDetails.length > 0) {
                objSelector.style.display = 'block';
            }
            
            // ────────────────────────────────────────────────────
            // Fleet Breakdown (expandable fleet cards)
            // ────────────────────────────────────────────────────
            if (playerFleet.fleetDetails && playerFleet.fleetDetails.length > 0) {
                const factionMap = { 0: ['Unknown','faction-unknown'], 1: ['MUD','faction-mud'], 2: ['ONI','faction-oni'], 3: ['USTUR','faction-ustur'] };
                
                let html = '<h3 class="fleet-breakdown-title">🚀 Fleet Breakdown</h3>';
                
                for (let fi = 0; fi < playerFleet.fleetDetails.length; fi++) {
                    const fleet = playerFleet.fleetDetails[fi];
                    const [factionName, factionClass] = factionMap[fleet.faction] || factionMap[0];
                    
                    // Get per-fleet ships (prefer fleets array with resolved stats, fallback to aggregated)
                    const perFleetShips = (playerFleet.fleets && playerFleet.fleets[fi])
                        ? playerFleet.fleets[fi].ships
                        : [];

                    // Also build assignedShips from aggregated data for ship list display
                    const assignedShips = [];
                    let fleetShipTotal = 0;
                    let fleetPointsUsed = 0;
                    const classPoints = { '1': 1, '2': 4, '3': 9, '4': 16, '5': 25, '6': 36, '7': 49, '9': 81 };
                    
                    for (const ship of playerFleet.ships) {
                        if (!ship.fleetAssignments) continue;
                        for (const fa of ship.fleetAssignments) {
                            if (fa.label === fleet.label) {
                                assignedShips.push({ name: ship.name, amount: fa.amount, symbol: ship.symbol, stats: ship.stats });
                                fleetShipTotal += fa.amount;
                                if (ship.stats && ship.stats.class) {
                                    fleetPointsUsed += (classPoints[ship.stats.class] || 1) * fa.amount;
                                }
                            }
                        }
                    }

                    // Calculate per-fleet metrics
                    const fleetMetrics = perFleetShips.length > 0
                        ? calculatePerFleetMetrics(perFleetShips)
                        : { totalMining: 0, totalCargo: 0, totalFuel: 0, totalPoints: fleetPointsUsed, totalShips: fleetShipTotal, totalSduPerHour: 0, totalScanCost: 0, fuelAutonomy: 0, score: 0 };
                    
                    // Performance rating
                    const perf = getFleetPerfRating(fleetMetrics, perFleetShips, selectedObjective);
                    const rec = perFleetShips.length > 0 ? generatePerFleetRec(fleetMetrics, perFleetShips, selectedObjective) : '';
                    
                    // Fleet point utilization color coding
                    const pointsColor = fleetPointsUsed <= 100 ? 'var(--text-secondary)' : 
                                       fleetPointsUsed <= 130 ? 'var(--accent)' : '#f59e0b';
                    const pointsStyle = fleetPointsUsed > 145 ? 'color:#ef4444;font-weight:700;' : `color:${pointsColor};`;
                    
                    html += `
                    <div class="fleet-card">
                        <div class="fleet-card-header" onclick="toggleFleetCard(this)">
                            <div>
                                <span class="fleet-card-name">${fleet.label}</span>
                                <div style="font-size:0.7rem;${pointsStyle}margin-top:0.15rem;font-family:var(--font-display);font-weight:600;letter-spacing:0.02em;">${fleetPointsUsed}/145 pts</div>
                            </div>
                            <div class="fleet-card-meta">
                                <span class="fleet-perf-rating" style="background:${perf.color}22;color:${perf.color};">${perf.rating} — ${perf.label}</span>
                                <span class="faction-badge ${factionClass}">${factionName}</span>
                                <span>${fleetShipTotal} ship${fleetShipTotal !== 1 ? 's' : ''}</span>
                                <svg class="fleet-card-toggle" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                        </div>
                        <div class="fleet-card-ships" id="fleetCard${fi}">
                            <div class="fleet-stats-grid">
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value">⛏ ${fleetMetrics.totalMining > 0 ? fleetMetrics.totalMining.toFixed(1) : '—'}</div>
                                    <div class="fleet-stat-mini-label">Mining Rate</div>
                                </div>
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value">📡 ${fleetMetrics.totalSduPerHour > 0 ? Math.round(fleetMetrics.totalSduPerHour).toLocaleString() : '—'}</div>
                                    <div class="fleet-stat-mini-label">SDU/Hour</div>
                                </div>
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value">📦 ${fleetMetrics.totalCargo > 0 ? Math.round(fleetMetrics.totalCargo).toLocaleString() : '—'}</div>
                                    <div class="fleet-stat-mini-label">Cargo</div>
                                </div>
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value">⛽ ${fleetMetrics.fuelAutonomy > 0 ? fleetMetrics.fuelAutonomy.toFixed(1) + 'h' : '—'}</div>
                                    <div class="fleet-stat-mini-label">Fuel Autonomy</div>
                                </div>
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value" style="color:${pointsColor};">${fleetPointsUsed}/145</div>
                                    <div class="fleet-stat-mini-label">Fleet Points</div>
                                </div>
                                <div class="fleet-stat-mini">
                                    <div class="fleet-stat-mini-value">${fleetMetrics.score}</div>
                                    <div class="fleet-stat-mini-label">Score</div>
                                </div>
                            </div>
                            ${rec ? `<div class="fleet-rec">${rec}</div>` : ''}
                            ${assignedShips.map(s => {
                                const shipPoints = s.stats ? (classPoints[s.stats.class] || 1) * s.amount : s.amount;
                                const pointsText = s.stats ? ` (${shipPoints}pts)` : '';
                                return `
                                <div class="fleet-ship-row">
                                    <span class="fleet-ship-name">${s.name}${pointsText}</span>
                                    <span class="fleet-ship-count">×${s.amount}</span>
                                </div>
                            `}).join('')}
                            ${assignedShips.length === 0 ? '<div class="fleet-ship-row"><span class="fleet-ship-name" style="color:var(--text-tertiary);">No ship data resolved</span></div>' : ''}
                        </div>
                    </div>`;
                }
                
                breakdownContainer.innerHTML = html;
                breakdownContainer.style.display = 'block';
            } else {
                breakdownContainer.style.display = 'none';
            }
            
            // ────────────────────────────────────────────────────
            // Complete Ship Roster (all unique ship types)
            // ────────────────────────────────────────────────────
            if (playerFleet.ships.length > 0) {
                // Sort ships by quantity (descending)
                const sortedShips = [...playerFleet.ships].sort((a, b) => (b.owned || 1) - (a.owned || 1));
                
                let rosterHtml = '<h3 class="ship-roster-title">📋 Ship Roster</h3>';
                rosterHtml += '<div class="ship-roster-grid">';
                
                for (const ship of sortedShips) {
                    const qty = ship.owned || 1;
                    const stats = ship.stats;
                    const sizeClass = stats ? (['','XXS','XS','S','M','L','Capital','Commander','Titan'][stats.sizeClass] || '?') : '?';
                    const miningRate = stats ? stats.miningRate.toLocaleString() : '—';
                    const cargo = stats ? stats.cargoCapacity.toLocaleString() : '—';
                    
                    // Fleet assignments
                    const fleetInfo = ship.fleetAssignments 
                        ? ship.fleetAssignments.map(fa => fa.label).join(', ')
                        : '';
                    
                    rosterHtml += `
                    <div class="ship-roster-card">
                        <div class="ship-roster-name">${ship.name}</div>
                        <div class="ship-roster-details">
                            <span class="ship-roster-qty">×${qty}</span>
                            <span class="ship-roster-class">${sizeClass}</span>
                        </div>
                        ${stats ? `
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.25rem;margin-top:0.5rem;font-size:0.7rem;color:var(--text-tertiary);font-family:var(--font-display);">
                            <span>⛏ ${miningRate}</span>
                            <span>📦 ${cargo}</span>
                        </div>` : ''}
                        ${fleetInfo ? `<div style="font-size:0.65rem;color:var(--text-tertiary);margin-top:0.35rem;opacity:0.6;font-family:var(--font-display);letter-spacing:0.02em;">${fleetInfo}</div>` : ''}
                    </div>`;
                }
                
                rosterHtml += '</div>';
                rosterContainer.innerHTML = rosterHtml;
                rosterContainer.style.display = 'block';
            } else {
                rosterContainer.style.display = 'none';
            }
            
            section.classList.add('visible');
        }

        // Toggle fleet card expansion
        function toggleFleetCard(headerEl) {
            const card = headerEl.closest('.fleet-card');
            const ships = card.querySelector('.fleet-card-ships');
            const toggle = card.querySelector('.fleet-card-toggle');
            ships.classList.toggle('expanded');
            toggle.classList.toggle('open');
        }

        // Select target objective
        function selectObjective(objective) {
            selectedObjective = objective;
            document.querySelectorAll('.objective-pill').forEach(p => {
                p.classList.toggle('active', p.dataset.objective === objective);
            });
            // Re-render fleet cards and recommendations
            if (playerFleet) {
                showPlayerFleet();
                showPersonalizedRecommendations();
            }
        }

        // Calculate per-fleet metrics
        function calculatePerFleetMetrics(fleetShips) {
            const classPoints = { '1': 1, '2': 4, '3': 9, '4': 16, '5': 25, '6': 36, '7': 49, '9': 81 };
            let totalMining = 0, totalCargo = 0, totalFuel = 0, totalPoints = 0, totalShips = 0;
            let totalSduPerHour = 0, totalScanCost = 0;

            for (const s of fleetShips) {
                const count = s.amount || 1;
                totalShips += count;
                if (s.stats) {
                    totalMining += s.stats.miningRate * count;
                    totalCargo += s.stats.cargoCapacity * count;
                    totalFuel += s.stats.fuelCapacity * count;
                    totalPoints += (classPoints[s.stats.class] || 1) * count;
                    if (s.stats.scanCoolDown > 0) {
                        totalSduPerHour += (s.stats.sduPerScan / s.stats.scanCoolDown) * 3600 * count;
                        totalScanCost += s.stats.scanCost * count;
                    }
                }
            }

            // Fuel autonomy: hours of subwarp before fuel runs out (weighted avg)
            let fuelAutonomy = 0;
            if (fleetShips.length > 0) {
                let totalFuelConsumption = 0;
                for (const s of fleetShips) {
                    if (s.stats) totalFuelConsumption += s.stats.subwarpFuelConsumptionRate * (s.amount || 1);
                }
                fuelAutonomy = totalFuelConsumption > 0 ? totalFuel / totalFuelConsumption : 0;
            }

            // Mini composition score (0-100)
            let score = 0;
            score += Math.min(30, totalMining / 10); // mining contribution
            score += Math.min(20, totalSduPerHour / 100); // scanning contribution
            score += Math.min(20, totalCargo / 50000); // cargo contribution
            if (totalPoints <= 145 && totalPoints >= 100) score += 20;
            else if (totalPoints < 100) score += Math.min(20, totalPoints / 100 * 20);
            else score += Math.max(0, 20 - (totalPoints - 145) * 2);
            // Diversity bonus
            const hasMiner = fleetShips.some(s => s.stats?.spec === 'Miner');
            const hasScanner = fleetShips.some(s => s.stats?.spec === 'Data Runner');
            if (hasMiner && hasScanner) score += 10;
            else if (hasMiner || hasScanner) score += 5;
            score = Math.round(Math.min(100, Math.max(0, score)));

            return { totalMining, totalCargo, totalFuel, totalPoints, totalShips, totalSduPerHour, totalScanCost, fuelAutonomy, score };
        }

        // Generate per-fleet recommendation based on objective
        function generatePerFleetRec(metrics, fleetShips, objective) {
            const hasMiner = fleetShips.some(s => s.stats?.spec === 'Miner');
            const hasScanner = fleetShips.some(s => s.stats?.spec === 'Data Runner');
            const hasFreight = fleetShips.some(s => s.stats?.cargoCapacity > 100000);
            const hasZeroAmmo = fleetShips.some(s => s.stats?.ammoConsumptionRate === 0 && s.stats?.miningRate > 0);
            const pointsLeft = 145 - metrics.totalPoints;

            if (objective === 'mining') {
                if (!hasMiner && !hasZeroAmmo) return '⛏️ No dedicated miners. Add Armstrong IMP series for zero-ammo mining.';
                if (metrics.totalCargo < metrics.totalMining * 24 * 8) return '📦 Cargo fills too fast for 8h cycles. Add freight capacity or schedule more frequent runs.';
                if (hasZeroAmmo) return '✅ Zero-ammo miners detected — excellent for sustained mining ops.';
                return '⛏️ Good mining setup. Consider upgrading to Armstrong IMPs for zero ammo costs.';
            }
            if (objective === 'scanning') {
                if (!hasScanner) return '📡 No Data Runners! Add VZUS opod or Fimbul BYOS Ranger for zero-cost SDU generation.';
                if (metrics.totalScanCost > 0) return '💰 Some scanners have scan costs. Prioritize Data Runners (scanCost=0) for maximum SDU profit.';
                return `✅ Strong scanning fleet — ${Math.round(metrics.totalSduPerHour)} SDU/hour with zero scan costs.`;
            }
            if (objective === 'crafting') {
                if (!hasMiner && !hasScanner) return '🏗️ FICs need 5 SDU + resources. This fleet has neither miners nor scanners.';
                if (!hasScanner) return '📡 Missing scanners for SDU production. FICs require 5 SDU each — add a Data Runner.';
                if (!hasMiner) return '⛏️ Missing miners for resource input. FICs need materials — add mining capability.';
                return '✅ Mixed miner + scanner fleet — good for Faction Infrastructure Contracts.';
            }
            // balanced
            if (pointsLeft >= 25) return `⚡ ${pointsLeft} fleet points unused. Fill with specialist ships for better utilization.`;
            if (!hasScanner && metrics.totalMining > 10) return '📡 Pure mining fleet — adding a Data Runner would diversify income streams.';
            if (!hasMiner && metrics.totalSduPerHour > 0) return '⛏️ Pure scanning fleet — adding miners would enable FIC production.';
            return '⚖️ Well-balanced fleet composition.';
        }

        // Get performance rating for a fleet given an objective
        function getFleetPerfRating(metrics, fleetShips, objective) {
            let rating = 'C', color = 'var(--text-tertiary)', label = 'Average';
            const hasMiner = fleetShips.some(s => s.stats?.spec === 'Miner');
            const hasScanner = fleetShips.some(s => s.stats?.spec === 'Data Runner');

            if (objective === 'mining') {
                const s = metrics.totalMining;
                if (s >= 100) { rating = 'S'; color = 'var(--accent)'; label = 'Excellent Miner'; }
                else if (s >= 20) { rating = 'A'; color = '#00d4aa'; label = 'Strong Miner'; }
                else if (s >= 5) { rating = 'B'; color = '#f59e0b'; label = 'Moderate'; }
                else { label = 'Weak Mining'; }
            } else if (objective === 'scanning') {
                const s = metrics.totalSduPerHour;
                if (s >= 2000) { rating = 'S'; color = 'var(--accent)'; label = 'Excellent Scanner'; }
                else if (s >= 500) { rating = 'A'; color = '#00d4aa'; label = 'Strong Scanner'; }
                else if (s >= 50) { rating = 'B'; color = '#f59e0b'; label = 'Moderate'; }
                else { label = 'Weak Scanning'; }
            } else if (objective === 'crafting') {
                if (hasMiner && hasScanner) { rating = 'A'; color = '#00d4aa'; label = 'FIC Ready'; }
                else if (hasMiner || hasScanner) { rating = 'B'; color = '#f59e0b'; label = 'Partial'; }
                else { label = 'Not FIC Capable'; }
            } else {
                const s = metrics.score;
                if (s >= 80) { rating = 'S'; color = 'var(--accent)'; label = 'Optimal'; }
                else if (s >= 60) { rating = 'A'; color = '#00d4aa'; label = 'Strong'; }
                else if (s >= 40) { rating = 'B'; color = '#f59e0b'; label = 'Good'; }
                else { label = 'Needs Work'; }
            }
            return { rating, color, label };
        }

        // Calculate real fleet statistics using SAGE data
        function calculateRealFleetStats(ships) {
            let totalMiningRate = 0;
            let totalCargoCapacity = 0;
            let totalCrewRequired = 0;
            let totalShips = 0;
            let totalFuelCapacity = 0;
            
            ships.forEach(ship => {
                const count = ship.owned || 1;
                totalShips += count;
                
                if (ship.stats) {
                    totalMiningRate += ship.stats.miningRate * count;
                    totalCargoCapacity += ship.stats.cargoCapacity * count;
                    totalCrewRequired += ship.stats.requiredCrew * count;
                    totalFuelCapacity += ship.stats.fuelCapacity * count;
                }
            });
            
            return {
                totalShips,
                totalMiningRate,
                totalCargoCapacity,
                totalCrewRequired,
                totalFuelCapacity,
                avgMiningRate: totalShips > 0 ? totalMiningRate / totalShips : 0,
                avgCargoCapacity: totalShips > 0 ? totalCargoCapacity / totalShips : 0,
                avgCrewPerShip: totalShips > 0 ? totalCrewRequired / totalShips : 0
            };
        }

        // Calculate fleet composition score
        function calculateFleetCompositionScore(analysis, ships = null) {
            let score = 0;
            
            // 1. Mining Efficiency with Consumable Consideration (0-25 points)
            if (ships) {
                const impShips = ships.filter(s => s.stats?.ammoConsumptionRate === 0 && s.stats?.miningRate > 0);
                const impMiningRate = impShips.reduce((sum, s) => sum + s.stats.miningRate * s.owned, 0);
                const totalMiningRate = analysis.totalMiningRate;
                
                // Reward zero-ammo mining heavily
                const impRatio = totalMiningRate > 0 ? impMiningRate / totalMiningRate : 0;
                score += Math.min(25, (analysis.totalMiningRate / 50) * (1 + impRatio));
            } else {
                score += Math.min(25, analysis.totalMiningRate / 50);
            }
            
            // 2. Cargo-to-Mining Balance (0-25 points)
            if (analysis.totalMiningRate > 0) {
                const hoursToFillCargo = analysis.totalCargoCapacity / (analysis.totalMiningRate * 24);
                // Perfect score if cargo lasts 8+ hours, declining below that
                score += Math.min(25, hoursToFillCargo * 3);
            }
            
            // 3. Activity Diversification (0-25 points)
            if (ships) {
                const hasDataRunner = ships.some(s => s.stats?.spec === 'Data Runner');
                const hasFreighter = ships.some(s => s.stats?.cargoCapacity > 100000);
                const hasMiner = ships.some(s => s.stats?.miningRate > 10);
                
                let diversityScore = 0;
                if (hasMiner) diversityScore += 8;
                if (hasDataRunner) diversityScore += 9; // SDU generation is valuable
                if (hasFreighter) diversityScore += 8;
                
                score += diversityScore;
            }
            
            // 4. Fleet Point Utilization (0-25 points) - Reality: 145pt cap
            if (ships) {
                const classPoints = { '1': 1, '2': 4, '3': 9, '4': 16, '5': 25, '6': 36, '7': 49, '9': 81 };
                const totalPoints = ships.reduce((sum, ship) => 
                    sum + (classPoints[ship.stats?.class] || 1) * ship.owned, 0
                );
                
                // Optimal utilization: 120-145 points (allows tactical flexibility)
                // Penalty for going over 145 (impossible in SAGE)
                if (totalPoints > 145) {
                    score += Math.max(0, 25 - ((totalPoints - 145) * 2)); // Heavy penalty for violations
                } else if (totalPoints >= 120) {
                    score += 25; // Perfect score for 120-145 range
                } else if (totalPoints >= 100) {
                    score += 20 + ((totalPoints - 100) / 20) * 5; // Good utilization
                } else {
                    score += Math.min(20, (totalPoints / 100) * 20); // Declining below 100
                }
            } else {
                // Fallback for legacy calls
                score += Math.min(25, analysis.totalShips * 2);
            }
            
            return Math.round(Math.max(0, Math.min(100, score)));
        }

        // Show personalized recommendations with real stats
        function showPersonalizedRecommendations() {
            if (!playerFleet) return;
            
            const section = document.getElementById('personalizedRecommendations');
            const content = document.getElementById('personalRecContent');
            
            // Generate recommendations based on real ship stats
            const recommendations = generateRealStatsRecommendations(playerFleet.ships, selectedObjective);
            
            // Build content
            let html = '<div class="rec-grid">';
            
            recommendations.forEach(rec => {
                html += `
                    <div class="rec-card">
                        <h4 class="rec-card-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                ${rec.icon}
                            </svg>
                            ${rec.title}
                        </h4>
                        <p class="rec-card-desc">${rec.description}</p>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add real earnings estimate
            const fleetStats = calculateRealFleetStats(playerFleet.ships);
            const estimatedDaily = calculateRealEarnings(fleetStats, playerFleet.ships);
            html += `
                <div class="earnings-estimate">
                    <div class="earnings-title">Estimated Daily Mining Potential</div>
                    <div class="earnings-value">${estimatedDaily.toLocaleString()} units</div>
                    <div class="earnings-period">Per day with optimal operations (Richness=1, Hardness=1)</div>
                </div>
            `;
            
            content.innerHTML = html;
            section.classList.add('visible');
        }

        // Generate recommendations based on real ship statistics
        function generateRealStatsRecommendations(ships, objective = 'balanced') {
            const recommendations = [];
            const fleetStats = calculateRealFleetStats(ships);
            const objectiveLabels = { mining: '⛏️ Mining', scanning: '📡 Scanning', crafting: '🏗️ Crafting', balanced: '⚖️ Balanced' };
            
            // Add objective context header
            if (objective !== 'balanced') {
                recommendations.push({
                    icon: '<circle cx="12" cy="12" r="10"/><path d="M12 8v4l2 2"/>',
                    title: `${objectiveLabels[objective]} Focus Active`,
                    description: objective === 'mining' 
                        ? 'Recommendations optimized for maximum resource extraction. Prioritizing mining rate, zero-ammo ships, and cargo capacity for sustained 24h autonomous cycles.'
                        : objective === 'scanning'
                        ? 'Recommendations optimized for SDU generation. Prioritizing Data Runners with zero scan costs, low scan cooldowns, and high sduPerScan values for Data Running profits.'
                        : 'Recommendations optimized for Faction Infrastructure Contracts. FICs require 5 SDU + resources per contract (2 ATLAS each). Need both scanning AND mining capability.'
                });
            }
            
            // Check for Armstrong IMP advantage (zero ammo cost)
            const impShips = ships.filter(ship => 
                ship.stats && ship.stats.manufacturer === 'Armstrong' && 
                ship.stats.ammoConsumptionRate === 0
            );
            const nonImpMiners = ships.filter(ship => 
                ship.stats && ship.stats.miningRate > 0 && ship.stats.ammoConsumptionRate > 0
            );
            const dataRunners = ships.filter(ship => 
                ship.stats && ship.stats.spec === 'Data Runner'
            );

            // Mining recommendations (show for mining, crafting, balanced)
            if (objective !== 'scanning') {
                if (impShips.length > 0) {
                    const impMiningRate = impShips.reduce((sum, ship) => sum + (ship.stats.miningRate * ship.owned), 0);
                    recommendations.push({
                        icon: '<circle cx="12" cy="12" r="10"/><line x1="22" y1="2" x2="11" y2="13"/>',
                        title: '🏆 Armstrong IMP Advantage Detected',
                        description: objective === 'mining'
                            ? `Your ${impShips.length} Armstrong IMP ships (${Math.round(impMiningRate)} mining rate) are IDEAL for your mining objective. Zero ammo = maximum 24h cycle profit. Target high-richness sectors (MRZ-8, MRZ-16, MRZ-31). Optimize cargo capacity for 8-24h unattended cycles.`
                            : `Your ${impShips.length} Armstrong IMP ships (${Math.round(impMiningRate)} mining rate) consume ZERO ammunition during mining. Deploy for primary mining in high-richness sectors.`
                    });
                } else if (nonImpMiners.length > 0 && (objective === 'mining' || objective === 'crafting')) {
                    recommendations.push({
                        icon: '<circle cx="12" cy="12" r="10"/><line x1="22" y1="2" x2="11" y2="13"/>',
                        title: '⚠️ High Ammo Costs — Upgrade to Armstrong IMPs',
                        description: `Your ${nonImpMiners.length} mining ships consume ammunition. For ${objective === 'mining' ? 'maximum extraction' : 'FIC resource production'}, upgrade to Armstrong IMP series (IMP Tip 9pts, IMP Tap 16pts, IMP 36pts) for zero-ammo mining. Critical for profitable 24h autonomous cycles.`
                    });
                }
            }
            
            // Scanning recommendations (show for scanning, crafting, balanced)
            if (objective !== 'mining') {
                if (dataRunners.length > 0) {
                    const totalSduPerHour = dataRunners.reduce((sum, ship) => 
                        sum + (ship.stats.sduPerScan / ship.stats.scanCoolDown) * 3600 * ship.owned, 0
                    );
                    recommendations.push({
                        icon: '<path d="M13 7l5 5-5 5"/><path d="M6 12h12"/>',
                        title: '💎 Data Runner Fleet Excellence',
                        description: objective === 'scanning'
                            ? `Your ${dataRunners.length} Data Runners generate ~${Math.round(totalSduPerHour)} SDU/hour with ZERO scan costs. Maximize by deploying to highest Information Density sectors. Each scan cycle is pure profit. Target sectors near starbase for quick deposits.`
                            : objective === 'crafting'
                            ? `Your ${dataRunners.length} Data Runners generate ~${Math.round(totalSduPerHour)} SDU/hour. At 5 SDU per FIC (2 ATLAS each), that's ~${Math.round(totalSduPerHour/5)} potential FICs/hour. Pair with miners for complete FIC production.`
                            : `Your ${dataRunners.length} Data Runner ships generate ~${Math.round(totalSduPerHour)} SDU/hour with ZERO scan costs. Focus on high Information Density sectors.`
                    });
                } else if (fleetStats.totalShips > 0 && objective !== 'mining') {
                    recommendations.push({
                        icon: '<path d="M13 7l5 5-5 5"/><path d="M6 12h12"/>',
                        title: objective === 'scanning' ? '🚨 No Data Runners — Critical Gap' : '📡 Missing Data Runner Capability',
                        description: objective === 'scanning'
                            ? 'You have NO Data Runners! For scanning objectives, VZUS opod (378 SDU/scan, 300s cooldown, 0 cost) and Fimbul BYOS Ranger (378 SDU/scan, 300s cooldown, 0 cost) are essential. Opal Rayfam (121 SDU/scan, 312s) is a Class-3 budget option.'
                            : 'Consider adding VZUS opod, Fimbul BYOS Ranger, or Opal Rayfam for SDU generation. Zero scan costs = guaranteed profit per scan cycle.'
                    });
                }
            }

            // Crafting-specific recommendation
            if (objective === 'crafting') {
                const hasMiner = impShips.length > 0 || nonImpMiners.length > 0;
                const hasScanner = dataRunners.length > 0;
                if (hasMiner && hasScanner) {
                    recommendations.push({
                        icon: '<rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3l-4 4-4-4"/>',
                        title: '✅ FIC Production Ready',
                        description: 'Your fleet has both mining and scanning capability — ideal for Faction Infrastructure Contracts. Each FIC needs 5 SDU + resource materials. Coordinate scan & mine cycles: scan for SDUs, mine resources, craft FICs at starbase for 2 ATLAS each.'
                    });
                } else if (!hasMiner && !hasScanner) {
                    recommendations.push({
                        icon: '<rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3l-4 4-4-4"/>',
                        title: '🚨 No FIC Production Capability',
                        description: 'FICs require both SDUs (from scanning) and resources (from mining). Your fleet has neither. Add Armstrong IMP for mining + VZUS opod for scanning to start FIC production.'
                    });
                }
            }
            
            // Cargo-to-mining ratio analysis (relevant for mining & crafting)
            if ((objective === 'mining' || objective === 'crafting' || objective === 'balanced') && fleetStats.totalMiningRate > 0) {
                const cargoFillHours = fleetStats.totalCargoCapacity / (fleetStats.totalMiningRate * 24);
                if (cargoFillHours < 1) {
                    recommendations.push({
                        icon: '<path d="M14 7V4a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v3"/>',
                        title: '🚛 Cargo Bottleneck Identified',
                        description: `Your fleet fills cargo in ${cargoFillHours.toFixed(1)} hours. ${objective === 'mining' ? 'Critical for mining objective: ' : ''}Add transport ships (Fimbul Sledbarge: 609K cargo, Pearce D9: 553K cargo) or schedule automated cargo runs.`
                    });
                }
            }
            
            // Fleet point efficiency
            const totalPoints = ships.reduce((sum, ship) => {
                const classPoints = { '1': 1, '2': 4, '3': 9, '4': 16, '5': 25, '6': 36, '7': 49, '9': 81 };
                return sum + (classPoints[ship.stats?.class] || 1) * ship.owned;
            }, 0);
            const pointsRemaining = 145 - totalPoints;
            
            if (totalPoints > 145) {
                recommendations.push({
                    icon: '<polygon points="13,2 3,14 12,22 22,10"/>',
                    title: '⚠️ Fleet Exceeds Point Cap',
                    description: `Your fleet uses ${totalPoints}/145 points (${totalPoints - 145} over). SAGE enforces a 145-point limit per fleet. Redistribute ships across multiple fleets.`
                });
            } else if (pointsRemaining >= 25) {
                const fillSuggestion = objective === 'mining' ? 'Armstrong IMP Tip (9pts) or IMP Tap (16pts) for zero-ammo mining'
                    : objective === 'scanning' ? 'Opal Rayfam (9pts, Data Runner) for more SDU generation'
                    : objective === 'crafting' ? 'a mix of miners and scanners for FIC production'
                    : 'Armstrong IMP series (16pts) or Class-3 specialists (9pts)';
                recommendations.push({
                    icon: '<polygon points="13,2 3,14 12,22 22,10"/>',
                    title: '⚡ Fleet Expansion Available',
                    description: `${pointsRemaining} points remaining. Add ${fillSuggestion} to maximize your ${objective} potential.`
                });
            }
            
            return recommendations.slice(0, 5); // Limit to 5 (1 objective header + 4 recs)
        }

        // Calculate real earnings potential
        function calculateRealEarnings(fleetStats, ships = null) {
            // Improved calculation including consumable costs
            const hoursPerDay = 24;
            const baseRichness = 1; // Default richness (can be 1.5x or 2.0x in better sectors)
            const baseHardness = 1; // Default hardness
            
            // Estimate resource price in ATLAS (simplified)
            const avgResourcePrice = 0.001; // ATLAS per unit of raw material
            
            // Estimate consumable prices (ATLAS per unit)
            const fuelPrice = 0.0001;
            const foodPrice = 0.0002; 
            const ammoPrice = 0.0001;
            
            // Calculate gross mining output
            const effectiveMiningRate = fleetStats.totalMiningRate * (baseRichness / baseHardness);
            const grossDailyOutput = effectiveMiningRate * hoursPerDay;
            const grossDailyValue = grossDailyOutput * avgResourcePrice;
            
            // Calculate consumable costs if we have ship details
            let totalDailyConsumableCosts = 0;
            
            if (ships && Array.isArray(ships)) {
                ships.forEach(ship => {
                    const count = ship.owned || 1;
                    if (ship.stats) {
                        // Daily fuel cost (assume mix of mining and movement)
                        const dailyFuelCost = ship.stats.subwarpFuelConsumptionRate * 6 * fuelPrice * count; // 6h movement per day
                        
                        // Daily food cost (during active mining)
                        const dailyFoodCost = ship.stats.foodConsumptionRate * hoursPerDay * foodPrice * count;
                        
                        // Daily ammo cost (only if ship consumes ammo - Armstrong IMP series = 0)
                        const dailyAmmoCost = (ship.stats.ammoConsumptionRate || 0) * hoursPerDay * ammoPrice * count;
                        
                        totalDailyConsumableCosts += dailyFuelCost + dailyFoodCost + dailyAmmoCost;
                    }
                });
            }
            
            // Net daily profit
            const netDailyProfit = grossDailyValue - totalDailyConsumableCosts;
            
            return Math.round(Math.max(0, netDailyProfit * 1000)); // Convert back to units for display
        }

        // Show no fleet found state
        function showNoFleetFound() {
            const noFleetState = document.getElementById('noFleetState');
            noFleetState.classList.add('visible');
            
            // Hide other sections
            document.getElementById('yourFleetSection').classList.remove('visible');
            document.getElementById('personalizedRecommendations').classList.remove('visible');
        }

        // Try demo with real high-quality ship data
        function tryDemo() {
            // Generate demo fleet using real ship stats for compelling showcase
            const demoShips = [
                { symbol: 'IMP3', name: 'Armstrong IMP', owned: 1, stats: SAGE_SHIP_STATS.find(s => s.symbol === 'IMP3'), realStats: true },
                { symbol: 'HEART', name: 'Busan Maiden Heart', owned: 1, stats: SAGE_SHIP_STATS.find(s => s.symbol === 'HEART'), realStats: true },
                { symbol: 'FBLSLE', name: 'Fimbul Sledbarge', owned: 2, stats: SAGE_SHIP_STATS.find(s => s.symbol === 'FBLSLE'), realStats: true },
                { symbol: 'VZUSOP', name: 'VZUS opod', owned: 1, stats: SAGE_SHIP_STATS.find(s => s.symbol === 'VZUSOP'), realStats: true },
                { symbol: 'CALG', name: 'Calico Guardian', owned: 1, stats: SAGE_SHIP_STATS.find(s => s.symbol === 'CALG'), realStats: true }
            ];
            
            playerFleet = {
                walletAddress: 'DEMO_FLEET_SIMULATION',
                ships: demoShips
            };
            
            // Clear any error states
            clearWalletError();
            document.getElementById('noFleetState').classList.remove('visible');
            document.getElementById('walletInput').value = 'Demo Fleet — Real Ship Stats';
            
            // Show fleet analysis
            showPlayerFleet();
            showPersonalizedRecommendations();
        }

        // Try demo wallet
        function tryDemoWallet() {
            document.getElementById('walletInput').value = DEMO_WALLET;
            analyzeWallet();
        }

        // Nav scroll state
        window.addEventListener('scroll', () => {
            document.querySelector('nav').classList.toggle('scrolled', window.scrollY > 80);
        }, { passive: true });

        // Scroll reveal animation
        function setupScrollReveal() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -60px 0px'
            });

            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

        // Load Galaxy API data
        async function loadGalaxyData() {
            if (isLoading || galaxyData) return;
            
            isLoading = true;
            document.getElementById('loadingState').classList.add('visible');
            
            try {
                // Fetch from Galaxy API
                const response = await fetch('https://galaxy.staratlas.com/nfts');
                if (!response.ok) {
                    throw new Error(`Galaxy API failed: ${response.status}`);
                }
                
                const allNfts = await response.json();
                
                // Filter for ships only
                const ships = allNfts.filter(nft => 
                    nft.attributes && nft.attributes.itemType === 'ship'
                );
                
                console.log(`Galaxy API loaded: ${ships.length} ships from ${allNfts.length} total NFTs`);
                
                // Merge with our SAGE stats data
                galaxyData = ships.map(ship => {
                    // Find matching stats from our CSV data
                    const stats = SAGE_SHIP_STATS.find(stat => 
                        stat.symbol === ship.symbol || 
                        stat.shipName.toLowerCase() === ship.name.toLowerCase()
                    );
                    
                    return {
                        ...ship,
                        stats: stats,
                        realStats: !!stats
                    };
                });
                
                console.log(`Merged data: ${galaxyData.filter(s => s.stats).length} ships with stats`);
                
            } catch (error) {
                console.error('Failed to load Galaxy data, falling back to static data:', error);
                // Fallback to static data
                galaxyData = SAGE_SHIP_STATS.map(ship => ({
                    name: ship.shipName,
                    symbol: ship.symbol,
                    attributes: {
                        itemType: 'ship',
                        category: ship.spec.toLowerCase(),
                        rarity: ship.class <= 2 ? 'common' : ship.class <= 4 ? 'uncommon' : ship.class <= 6 ? 'rare' : 'epic',
                        class: `class-${ship.class}`,
                        tier: parseInt(ship.class)
                    },
                    markets: [{ ui: Math.random() * 5000 + 100 }],
                    stats: ship,
                    realStats: true
                }));
            }
            
            isLoading = false;
            document.getElementById('loadingState').classList.remove('visible');
        }

        // Select faction
        function selectFaction(faction) {
            if (faction === currentFaction || isLoading) return;
            
            currentFaction = faction;
            
            // Update UI
            document.querySelectorAll('.faction-pill').forEach(pill => {
                pill.classList.toggle('active', pill.dataset.faction === faction);
            });
            
            updateAnalysis();
        }

        // Update analysis based on selected faction with real stats
        function updateAnalysis() {
            if (!galaxyData) return;
            
            const faction = factionData[currentFaction];
            
            // Update faction header
            document.getElementById('factionTitle').textContent = `${faction.name} — ${faction.fullName}`;
            document.getElementById('factionDescription').textContent = faction.description;
            
            // Filter ships by faction using manufacturer mapping
            const factionShips = getFactionShips(currentFaction);
            
            // Calculate real statistics
            const stats = calculateFactionStats(factionShips);
            
            // Update stats display
            document.getElementById('shipCount').textContent = factionShips.length;
            document.getElementById('avgMiningRate').textContent = stats.avgMiningRate.toFixed(1);
            document.getElementById('avgCargo').textContent = Math.round(stats.avgCargoCapacity).toLocaleString();
            document.getElementById('avgWarpSpeed').textContent = stats.avgWarpSpeed.toFixed(3);
            
            // Update info cards with real data
            updateInfoCards(faction, factionShips);
            
            // Update ships grid
            updateShipsGrid(factionShips);
            
            // Update recommendations
            updateRecommendations(faction, factionShips);
            
            // Show results
            document.getElementById('resultsContainer').classList.add('visible');
        }

        // Get ships for faction based on manufacturer mapping
        function getFactionShips(faction) {
            if (!galaxyData) return [];
            
            const manufacturers = factionMapping[faction] || [];
            
            return galaxyData.filter(ship => 
                manufacturers.some(manufacturer => 
                    ship.stats && ship.stats.manufacturer.includes(manufacturer)
                )
            );
        }

        // Calculate faction statistics using real ship data
        function calculateFactionStats(ships) {
            if (!ships.length) return { avgMiningRate: 0, avgCargoCapacity: 0, avgWarpSpeed: 0, totalFirepower: 0 };
            
            let totalMining = 0;
            let totalCargo = 0;
            let totalWarpSpeed = 0;
            let totalAmmoCapacity = 0;
            
            ships.forEach(ship => {
                if (ship.stats) {
                    totalMining += ship.stats.miningRate || 0;
                    totalCargo += ship.stats.cargoCapacity || 0;
                    totalWarpSpeed += ship.stats.warpSpeed || 0;
                    totalAmmoCapacity += ship.stats.ammoCapacity || 0;
                }
            });
            
            return {
                avgMiningRate: totalMining / ships.length,
                avgCargoCapacity: totalCargo / ships.length,
                avgWarpSpeed: totalWarpSpeed / ships.length,
                totalFirepower: totalAmmoCapacity
            };
        }

        // Update info cards with real ship data
        function updateInfoCards(faction, ships) {
            // Top miners by mining rate
            const topMiners = ships
                .filter(ship => ship.stats && ship.stats.miningRate > 0)
                .sort((a, b) => b.stats.miningRate - a.stats.miningRate)
                .slice(0, 3);
            
            document.getElementById('topMiners').innerHTML = topMiners
                .map(ship => `<li>${ship.name} <span style="color: var(--accent);">(${ship.stats.miningRate.toFixed(1)} rate)</span></li>`)
                .join('');
            
            // Best cargo ships
            const topCargo = ships
                .filter(ship => ship.stats && ship.stats.cargoCapacity > 0)
                .sort((a, b) => b.stats.cargoCapacity - a.stats.cargoCapacity)
                .slice(0, 3);
            
            document.getElementById('topCargo').innerHTML = topCargo
                .map(ship => `<li>${ship.name} <span style="color: var(--accent);">(${ship.stats.cargoCapacity.toLocaleString()})</span></li>`)
                .join('');
            
            // Optimal sectors
            document.getElementById('optimalSectors').innerHTML = faction.sectors
                .map(sector => `<li>${sector}</li>`)
                .join('');
            
            // Strategic focus
            document.getElementById('strategicFocus').innerHTML = faction.strategy
                .map(strategy => `<li>${strategy}</li>`)
                .join('');
        }

        // Update ships grid with real stats
        function updateShipsGrid(ships) {
            const shipsGrid = document.getElementById('shipsGrid');
            
            if (!ships.length) {
                shipsGrid.innerHTML = '<div class="error-state"><div class="error-icon">🚫</div><p>No ships found for this faction</p></div>';
                return;
            }
            
            // Show up to 12 ships
            const displayShips = ships.slice(0, 12);
            
            shipsGrid.innerHTML = displayShips.map(ship => {
                const stats = ship.stats;
                const rarity = ship.attributes?.rarity || 'common';
                const spec = stats?.spec || 'Unknown';
                const shipClass = `Class ${stats?.class || '?'}`;
                
                return `
                    <div class="ship-card">
                        <div class="ship-header">
                            <div class="ship-rarity" style="background: ${rarityColors[rarity] || '#888888'};"></div>
                            <div class="ship-name">${ship.name}</div>
                        </div>
                        <div class="ship-info">${ship.symbol} • ${shipClass}</div>
                        ${stats ? `
                            <div class="ship-stats">
                                <div class="ship-stat">
                                    <span>Mining:</span>
                                    <span>${stats.miningRate.toFixed(1)}</span>
                                </div>
                                <div class="ship-stat">
                                    <span>Cargo:</span>
                                    <span>${stats.cargoCapacity.toLocaleString()}</span>
                                </div>
                                <div class="ship-stat">
                                    <span>Warp:</span>
                                    <span>${stats.warpSpeed.toFixed(2)}</span>
                                </div>
                                <div class="ship-stat">
                                    <span>Crew:</span>
                                    <span>${stats.requiredCrew}</span>
                                </div>
                            </div>
                        ` : ''}
                        <div class="ship-tags">
                            <div class="ship-tag">${spec}</div>
                            <div class="ship-tag">${stats?.manufacturer || 'Unknown'}</div>
                            <div class="ship-tag">${rarity}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update recommendations with real data insights
        function updateRecommendations(faction, ships) {
            const stats = calculateFactionStats(ships);
            const recommendations = [];
            
            // Mining-focused recommendation
            if (stats.avgMiningRate > 10) {
                recommendations.push({
                    title: `Leverage ${faction.name} Mining Superiority`,
                    description: `Your faction excels in resource extraction with an average mining rate of ${stats.avgMiningRate.toFixed(1)}. Focus on asteroid belt operations and resource monopolization.`,
                    priority: 'HIGH'
                });
            }
            
            // Cargo optimization
            if (stats.avgCargoCapacity > 50000) {
                recommendations.push({
                    title: 'Massive Cargo Operations',
                    description: `With ${Math.round(stats.avgCargoCapacity).toLocaleString()} average cargo capacity, your faction can dominate bulk trade routes and resource transportation across sectors.`,
                    priority: 'HIGH'
                });
            } else if (stats.avgCargoCapacity > 10000) {
                recommendations.push({
                    title: 'Medium-Range Trade Routes',
                    description: `Your cargo capacity of ${Math.round(stats.avgCargoCapacity).toLocaleString()} per ship is ideal for regional trade operations and resource distribution networks.`,
                    priority: 'MEDIUM'
                });
            }
            
            // Fleet composition strategy
            const totalShips = ships.length;
            if (totalShips > 15) {
                recommendations.push({
                    title: 'Diverse Fleet Advantage',
                    description: `With ${totalShips} ship types available, ${faction.name} offers exceptional operational flexibility. Build specialized fleets for different mission profiles.`,
                    priority: 'MEDIUM'
                });
            }
            
            // Faction-specific strategic recommendation
            recommendations.push({
                title: `${faction.name} Strategic Focus`,
                description: `Optimize operations in ${faction.sectors[0]} and ${faction.sectors[1]} where your faction maintains territorial advantages and resource access.`,
                priority: 'HIGH'
            });
            
            document.getElementById('recommendationsContainer').innerHTML = recommendations.map(rec => `
                <div class="recommendation-card">
                    <div class="rec-header">
                        <div class="rec-title">${rec.title}</div>
                        <div class="rec-priority">${rec.priority}</div>
                    </div>
                    <div class="rec-description">${rec.description}</div>
                </div>
            `).join('');
        }
        // ═══════════════════════════════════════════════════════
        // SAGE Fleet Optimizer Functions
        // ═══════════════════════════════════════════════════════

        // Initialize optimizer on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeFleetOptimizer();
        });

        function initializeFleetOptimizer() {
            populateShipInventoryGrid();
            populateArbitrageSelectors();
            updateFleetPointsDisplay();
        }

        function showOptimizerTab(tabName) {
            // Hide all content
            const contents = document.querySelectorAll('.optimizer-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Hide all tab active states
            const tabs = document.querySelectorAll('.optimizer-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected content and tab
            document.getElementById('optimizer-' + tabName).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        function populateShipInventoryGrid() {
            const grid = document.getElementById('shipInventoryGrid');
            grid.innerHTML = '';
            
            const classFilter = document.getElementById('shipClassFilter').value;
            
            Object.entries(SAGE_SHIPS).forEach(([code, ship]) => {
                if (classFilter && ship.class.toString() !== classFilter) {
                    return;
                }
                
                const card = document.createElement('div');
                card.className = 'ship-inventory-card';
                card.dataset.shipCode = code;
                
                const quantity = selectedOptimizerShips[code] || 0;
                if (quantity > 0) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <div class="ship-inventory-name">${ship.name}</div>
                    <div class="ship-inventory-class">Class ${ship.class} ${ship.type}</div>
                    <div class="ship-inventory-points">${ship.points} Fleet Points</div>
                    <div class="ship-inventory-stats">
                        Crew: ${ship.crew} | Cargo: ${ship.cargo.toLocaleString()}<br>
                        Mining: ${ship.mining.toLocaleString()} | Speed: ${ship.speed.toLocaleString()}
                    </div>
                    ${quantity > 0 ? `<div class="ship-inventory-quantity">${quantity}</div>` : ''}
                `;
                
                card.addEventListener('click', () => toggleOptimizerShip(code));
                grid.appendChild(card);
            });
        }

        function filterShipsByClass() {
            populateShipInventoryGrid();
        }

        function toggleOptimizerShip(shipCode) {
            if (!selectedOptimizerShips[shipCode]) {
                selectedOptimizerShips[shipCode] = 0;
            }
            selectedOptimizerShips[shipCode]++;
            
            // Remove if clicked too many times
            if (selectedOptimizerShips[shipCode] > 10) {
                selectedOptimizerShips[shipCode] = 0;
            }
            
            if (selectedOptimizerShips[shipCode] === 0) {
                delete selectedOptimizerShips[shipCode];
            }
            
            populateShipInventoryGrid();
            updateFleetPointsDisplay();
        }

        function updateFleetPointsDisplay() {
            totalOptimizerFleetPoints = 0;
            
            Object.entries(selectedOptimizerShips).forEach(([code, quantity]) => {
                totalOptimizerFleetPoints += SAGE_SHIPS[code].points * quantity;
            });
            
            document.getElementById('totalFleetPoints').textContent = totalOptimizerFleetPoints;
            document.getElementById('fleetsNeeded').textContent = Math.ceil(totalOptimizerFleetPoints / 145);
        }

        function selectFleetObjective(objective) {
            selectedFleetObjective = objective;
            
            const objectives = document.querySelectorAll('.objective-option');
            objectives.forEach(obj => obj.classList.remove('selected'));
            
            document.querySelector(`[data-objective="${objective}"]`).classList.add('selected');
        }

        function optimizeFleetComposition() {
            if (Object.keys(selectedOptimizerShips).length === 0) {
                alert('Please select some ships first!');
                return;
            }
            
            const results = document.getElementById('fleetOptimizerResults');
            results.style.display = 'block';
            
            // Create ship list for optimization
            const shipList = [];
            Object.entries(selectedOptimizerShips).forEach(([code, quantity]) => {
                for (let i = 0; i < quantity; i++) {
                    shipList.push({
                        code,
                        ...SAGE_SHIPS[code]
                    });
                }
            });
            
            // Run knapsack optimization
            const fleets = optimizeFleetKnapsack(shipList, selectedFleetObjective);
            
            let html = `<h3>Optimized Fleet Compositions</h3>`;
            
            if (fleets.length === 0) {
                html += '<div class="optimizer-error-box">No valid fleet compositions found. Try reducing ship selection or adjusting objective.</div>';
            } else {
                html += '<div class="optimizer-info-box">Fleets optimized using knapsack algorithm for maximum efficiency within 145-point limit.</div>';
                
                fleets.forEach((fleet, index) => {
                    const fleetPoints = fleet.ships.reduce((sum, ship) => sum + ship.points, 0);
                    const totalCargo = fleet.ships.reduce((sum, ship) => sum + ship.cargo, 0);
                    const totalMining = fleet.ships.reduce((sum, ship) => sum + ship.mining, 0);
                    const totalCrew = fleet.ships.reduce((sum, ship) => sum + ship.crew, 0);
                    
                    html += `
                        <div class="fleet-composition">
                            <div class="fleet-composition-title">Fleet ${index + 1} (${fleetPoints}/145 points)</div>
                            <div class="fleet-composition-ships">
                                ${fleet.ships.map(ship => ship.name).join(', ')}
                            </div>
                            <div class="fleet-composition-stats">
                                Total Cargo: ${totalCargo.toLocaleString()} | 
                                Mining Rate: ${totalMining.toLocaleString()} | 
                                Crew: ${totalCrew} | 
                                Efficiency Score: ${fleet.score.toFixed(1)}
                            </div>
                        </div>
                    `;
                });
            }
            
            results.innerHTML = html;
        }

        function optimizeFleetKnapsack(ships, objective) {
            // Sort ships by efficiency for the given objective
            const sortedShips = [...ships].sort((a, b) => {
                const scoreA = calculateShipEfficiencyScore(a, objective);
                const scoreB = calculateShipEfficiencyScore(b, objective);
                return scoreB / b.points - scoreA / a.points; // Efficiency per point
            });
            
            const fleets = [];
            const usedShips = new Set();
            
            // Greedy knapsack approach
            while (sortedShips.some(ship => !usedShips.has(ship))) {
                const fleet = { ships: [], totalPoints: 0, score: 0 };
                
                for (const ship of sortedShips) {
                    if (usedShips.has(ship)) continue;
                    
                    if (fleet.totalPoints + ship.points <= 145) {
                        fleet.ships.push(ship);
                        fleet.totalPoints += ship.points;
                        fleet.score += calculateShipEfficiencyScore(ship, objective);
                        usedShips.add(ship);
                    }
                }
                
                if (fleet.ships.length > 0) {
                    fleets.push(fleet);
                }
            }
            
            return fleets;
        }

        function calculateShipEfficiencyScore(ship, objective) {
            switch (objective) {
                case 'mining':
                    return ship.mining * 0.7 + ship.cargo * 0.3;
                case 'scanning':
                    return ship.cargo * 0.6 + ship.speed * 0.4;
                case 'freighting':
                    return ship.cargo * 0.8 + (10000 / (ship.fuel / ship.cargo)) * 0.2;
                case 'crafting':
                    return ship.crew * 300 + ship.cargo * 0.5;
                case 'profit':
                    return (ship.mining * 0.3 + ship.cargo * 0.3 + ship.crew * 100 + ship.speed * 0.2) / ship.points;
                default:
                    return ship.mining + ship.cargo;
            }
        }

        function calculateLPEfficiency() {
            const crew = parseInt(document.getElementById('lpAvailableCrew').value);
            const miningTravel = parseFloat(document.getElementById('lpMiningTravel').value);
            const starbaseTravel = parseFloat(document.getElementById('lpStarbaseTravel').value);
            const atlasPrice = parseFloat(document.getElementById('lpAtlasPrice').value);
            const priceMultiplier = parseFloat(document.getElementById('lpPriceMultiplier').value);
            
            const results = document.getElementById('lpResults');
            results.style.display = 'block';
            
            const lpEfficiencies = [];
            
            Object.entries(SAGE_RESOURCES).forEach(([code, resource]) => {
                if (!resource.points) return; // Skip raw materials
                
                const supplyChain = calculateResourceSupplyChain(code, crew);
                const totalTime = supplyChain.totalTime + miningTravel + starbaseTravel;
                const totalCost = supplyChain.totalCost * atlasPrice * priceMultiplier;
                const totalFees = supplyChain.totalFees * atlasPrice;
                
                const lpPerHour = resource.points / totalTime;
                const lpPerAtlas = resource.points / (totalCost + totalFees);
                
                lpEfficiencies.push({
                    name: resource.name,
                    points: resource.points,
                    totalTime: totalTime.toFixed(2),
                    totalCost: (totalCost + totalFees).toFixed(6),
                    lpPerHour: lpPerHour.toFixed(2),
                    lpPerAtlas: lpPerAtlas.toFixed(0),
                    efficiency: lpPerHour * lpPerAtlas // Combined metric
                });
            });
            
            // Sort by efficiency
            lpEfficiencies.sort((a, b) => b.efficiency - a.efficiency);
            
            let html = `
                <h3>LP Efficiency Rankings</h3>
                <div class="optimizer-info-box">Ranked by combined LP/hour × LP/ATLAS efficiency score. Higher is better.</div>
                <table class="optimizer-table">
                    <thead>
                        <tr>
                            <th>Resource</th>
                            <th>LP Points</th>
                            <th>Total Time (h)</th>
                            <th>Total Cost (ATLAS)</th>
                            <th>LP/Hour</th>
                            <th>LP/ATLAS</th>
                            <th>Efficiency Score</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            lpEfficiencies.forEach(item => {
                html += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.points}</td>
                        <td>${item.totalTime}</td>
                        <td>${item.totalCost}</td>
                        <td>${item.lpPerHour}</td>
                        <td>${item.lpPerAtlas}</td>
                        <td>${item.efficiency.toFixed(0)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            results.innerHTML = html;
        }

        function calculateResourceSupplyChain(resourceCode, availableCrew) {
            const resource = SAGE_RESOURCES[resourceCode];
            if (!resource) return { totalTime: 0, totalCost: 0, totalFees: 0 };
            
            let totalTime = resource.duration || 0;
            let totalCost = 0;
            let totalFees = resource.fee || 0;
            
            if (resource.inputs) {
                resource.inputs.forEach(inputCode => {
                    const input = SAGE_RESOURCES[inputCode];
                    if (input) {
                        if (input.priceRange) {
                            // Raw material - add mining/purchase cost
                            totalCost += (input.priceRange[0] + input.priceRange[1]) / 2;
                        } else {
                            // Crafted material - recurse
                            const subChain = calculateResourceSupplyChain(inputCode, availableCrew);
                            totalTime += subChain.totalTime;
                            totalCost += subChain.totalCost;
                            totalFees += subChain.totalFees * 1.05; // 5% compounding
                        }
                    }
                });
            }
            
            // Apply crew efficiency
            if (totalTime > 0 && availableCrew > 1) {
                totalTime = totalTime / Math.min(availableCrew, 10); // Cap crew efficiency
            }
            
            return { totalTime, totalCost, totalFees };
        }

        function populateArbitrageSelectors() {
            const resourceSelect = document.getElementById('arbitrageResource');
            const tradeShipSelect = document.getElementById('arbitrageTradeShip');
            
            // Populate resources
            Object.entries(SAGE_RESOURCES).forEach(([code, resource]) => {
                if (resource.priceRange) { // Only raw materials for arbitrage
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = resource.name;
                    resourceSelect.appendChild(option);
                }
            });
            
            // Populate freighter ships
            Object.entries(SAGE_SHIPS).forEach(([code, ship]) => {
                if (ship.type.includes('Freighter') || ship.type.includes('Transport') || ship.cargo > 5000) {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = `${ship.name} (${ship.cargo.toLocaleString()} cargo)`;
                    tradeShipSelect.appendChild(option);
                }
            });
        }

        function updateArbitragePriceSuggestions() {
            const resourceCode = document.getElementById('arbitrageResource').value;
            if (!resourceCode) return;
            
            const resource = SAGE_RESOURCES[resourceCode];
            if (resource && resource.priceRange) {
                document.getElementById('arbitrageBuyPrice').value = resource.priceRange[0];
                document.getElementById('arbitrageSellPrice').value = resource.priceRange[1];
            }
        }

        function calculateArbitrageProfit() {
            const resourceCode = document.getElementById('arbitrageResource').value;
            const shipCode = document.getElementById('arbitrageTradeShip').value;
            const buyPrice = parseFloat(document.getElementById('arbitrageBuyPrice').value);
            const sellPrice = parseFloat(document.getElementById('arbitrageSellPrice').value);
            const distance = parseInt(document.getElementById('arbitrageDistance').value);
            const trips = parseInt(document.getElementById('arbitrageTrips').value);
            
            if (!resourceCode || !shipCode || !buyPrice || !sellPrice) {
                alert('Please fill in all fields!');
                return;
            }
            
            const ship = SAGE_SHIPS[shipCode];
            const resource = SAGE_RESOURCES[resourceCode];
            
            if (!ship || !resource) {
                alert('Invalid ship or resource selection!');
                return;
            }
            
            const results = document.getElementById('arbitrageResults');
            results.style.display = 'block';
            
            // Calculate basic metrics
            const profitPerUnit = sellPrice - buyPrice;
            const maxCargo = ship.cargo;
            const profitPerTrip = profitPerUnit * maxCargo;
            const totalProfit = profitPerTrip * trips;
            
            // Estimate travel time (simplified)
            const travelTimePerTrip = distance * 2; // Round trip in hours
            const totalTime = travelTimePerTrip * trips;
            const profitPerHour = totalProfit / totalTime;
            
            // Estimate fuel costs (simplified)
            const fuelCostPerTrip = ship.fuel * 0.001 * distance * 2; // Rough estimate
            const totalFuelCost = fuelCostPerTrip * trips;
            const netProfit = totalProfit - totalFuelCost;
            
            let html = `
                <h3>Market Arbitrage Analysis</h3>
                <div class="optimizer-info-box">Trade route analysis for ${resource.name} using ${ship.name}</div>
                <table class="optimizer-table">
                    <tbody>
                        <tr>
                            <td><strong>Profit per Unit</strong></td>
                            <td>${profitPerUnit.toFixed(6)} ATLAS</td>
                        </tr>
                        <tr>
                            <td><strong>Max Cargo</strong></td>
                            <td>${maxCargo.toLocaleString()} units</td>
                        </tr>
                        <tr>
                            <td><strong>Profit per Trip</strong></td>
                            <td>${profitPerTrip.toFixed(4)} ATLAS</td>
                        </tr>
                        <tr>
                            <td><strong>Total Profit (${trips} trips)</strong></td>
                            <td>${totalProfit.toFixed(4)} ATLAS</td>
                        </tr>
                        <tr>
                            <td><strong>Estimated Total Time</strong></td>
                            <td>${totalTime.toFixed(1)} hours</td>
                        </tr>
                        <tr>
                            <td><strong>Profit per Hour</strong></td>
                            <td>${profitPerHour.toFixed(4)} ATLAS</td>
                        </tr>
                        <tr>
                            <td><strong>Estimated Fuel Cost</strong></td>
                            <td>${totalFuelCost.toFixed(4)} ATLAS</td>
                        </tr>
                        <tr>
                            <td><strong>Net Profit</strong></td>
                            <td style="color: ${netProfit > 0 ? 'var(--accent)' : '#ef4444'}">${netProfit.toFixed(4)} ATLAS</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            if (netProfit <= 0) {
                html += '<div class="optimizer-error-box">Warning: This route may not be profitable after fuel costs. Consider shorter distances or better price spreads.</div>';
            }
            
            results.innerHTML = html;
        }

    </script>

    <!-- ════════════════════════════════════════════════════
         Footer - Consistent Navigation Sitemap
    ════════════════════════════════════════════════════ -->
    <footer>
        <div class="footer-inner">
            <div class="footer-left">
                <div class="footer-logo">
                    <svg width="20" height="20" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                      <polygon points="16,8 24,12 24,20 16,24 8,20 8,12" 
                               fill="none" 
                               stroke="#00d4aa" 
                               stroke-width="2"/>
                      <circle cx="16" cy="16" r="2" fill="#00d4aa"/>
                    </svg>
                    SAGE-Agent
                </div>
                <p class="footer-desc">Built for Colosseum Agent Hackathon</p>
            </div>
            <div class="footer-nav">
                <div class="footer-section">
                    <h4>Product</h4>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="analyzer.html">Analyzer</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Learn</h4>
                    <ul>
                        <li><a href="../docs/manifesto.html">Manifesto</a></li>
                        <li><a href="../docs/roadmap.html">Roadmap</a></li>
                        <li><a href="https://github.com/artemis-sage-agent/sage-agent-demo" target="_blank" rel="noopener">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <span>© 2025 S.T.R.I.K.E. — All rights reserved</span>
            <span>Powered by Solana · Star Atlas · z.ink</span>
        </div>
    </footer>

</body>
</html>